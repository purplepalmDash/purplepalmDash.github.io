<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/06/05/installcryptedgentoo/>InstallCryptedGentoo</a></h1><span class=post-date>Jun 5, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Partition:</p><pre><code>livecd ~ # lsblk
NAME  MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0   7:0    0 479.7M  1 loop /mnt/livecd
sr0    11:0    1 527.4M  0 rom  /mnt/cdrom
vda   252:0    0    80G  0 disk 
zram0 253:0    0     0B  0 disk 
livecd ~ # parted /dev/vda
GNU Parted 3.6
Using /dev/vda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) mklabel gpt
(parted) unit MiB                                                         
(parted) mkpart primary 2 514
(parted) mkpart primary 515 -1                                            
(parted) name 1 boot                                                      
(parted) name 2 luks                                                      
(parted) set 1 boot on                                                    
(parted) q                                                                
Information: You may need to update /etc/fstab.
</code></pre><p>Setup crypts:</p><pre><code>livecd ~ # cryptsetup luksFormat  /dev/vda2

WARNING!
========
This will overwrite data on /dev/vda2 irrevocably.

Are you sure? (Type 'yes' in capital letters): YES
Enter passphrase for /dev/vda2: 
Verify passphrase: 
livecd ~ # cryptsetup open /dev/vda2 ct0
Enter passphrase for /dev/vda2: 
</code></pre><p>Mount to specified position:</p><pre><code>mkfs.btrfs /dev/mapper/ct0
mkfs.vfat -F32 /dev/vda1
mount /dev/mapper/ct0 /mnt/gentoo
</code></pre><p>Using btrfs&rsquo;s subvolume function:</p><pre><code>btrfs subvolume create /mnt/gentoo/subvol-root
btrfs subvolume create /mnt/gentoo/subvol-home
btrfs subvolume create /mnt/gentoo/subvol-snapshots
btrfs subvolume set-default /mnt/gentoo/subvol-root
umount /mnt/gentoo
mount /dev/mapper/ct0 /mnt/gentoo
</code></pre><p>prepare chroot:</p><pre><code>cd /mnt/gentoo
wget ......stage3
tar xpvf stage3-*.tar.xz --xattrs-include='*.*' --numeric-owner
</code></pre><p>specify jobs for building:</p><pre><code># nano /etc/portage/make.conf
MAKEOPTS=&quot;-j17&quot;
</code></pre><p>select mirror:</p><pre><code>mirrorselect -i -o &gt;&gt;/mnt/gentoo/etc/portage/make.conf
</code></pre><p>Setup ebuild repository sync address:</p><pre><code># mkdir etc/portage/repos.conf
# cp usr/share/portage/config/repos.conf etc/portage/repos.conf/gentoo.conf
# cat etc/portage/repos.conf/gentoo.conf | grep uri
sync-uri = rsync://rsync.mirrors.ustc.edu.cn/gentoo-portage
cp -L /etc/resolv.conf etc/
</code></pre><p>chroot-in:</p><pre><code>livecd /mnt/gentoo # mount --types proc /proc /mnt/gentoo/proc
livecd /mnt/gentoo # mount --rbind /sys /mnt/gentoo/sys
livecd /mnt/gentoo # mount --rbind /dev /mnt/gentoo/dev
####  then
chroot /mnt/gentoo
. /etc/profile
PS1=(chroot)$PS1
</code></pre><p>Mount vda1 for kernel/bootloader installation:</p><pre><code>mount /dev/vda1 /boot
</code></pre><p>Install gentoo ebuild repository:</p><pre><code>emerge-webrsync
emerge --sync 
</code></pre><p>Install and set editor:</p><pre><code>emerge -vj app-editors/vim
eselect editor set 2
. /etc/profile
PS1=(chroot)$PS1
</code></pre><p>update @world:</p><pre><code>eselect profile set 21
USE=&quot;X initramfs cjk cups crypt udev alsa elogind zsh-completion bash-completion -consolekit&quot;
emerge --ask --verbose --update --deep --changed-use @world
</code></pre><p>Select the locale and timezone:</p><pre><code>echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone
emerge --config sys-libs/timezone-data
vim /etc/locale.gen
locale-gen 
eselect locale set 6
env-update &amp;&amp; source /etc/profile &amp;&amp; export PS1=&quot;(chroot) $PS1&quot;
</code></pre><p>Install firmware:</p><pre><code>mkdir -p /etc/portage/package.license
echo 'sys-kernel/linux-firmware linux-fw-redistributable no-source-code' &gt;/etc/portage/package.license/linux-firmware
echo 'sys-kernel/installkernel dracut' &gt;/etc/portage/package.use/installkernel
emerge --ask sys-kernel/gentoo-sources
emerge --ask sys-kernel/linux-firmware
emerge --ask sys-apps/pciutils
emerge --ask sys-kernel/genkernel
</code></pre><p>Set kernel:</p><pre><code>(chroot) livecd / # readlink -v /usr/src/linux
readlink: /usr/src/linux: No such file or directory
(chroot) livecd / # eselect kernel list
Available kernel symlink targets:
  [1]   linux-6.6.30-gentoo
(chroot) livecd / # eselect kernel set 1
(chroot) livecd / # readlink -v /usr/src/linux
linux-6.6.30-gentoo
</code></pre><p>Build kernel:</p><pre><code>cd /usr/src/linux
 make menuconfig
 make -j17
 make modules_install &amp;&amp; make install
 genkernel --kernel-config=/usr/src/linux/.config initramfs
 blkid /dev/vda1&gt;&gt;/etc/fstab
 blkid /dev/mapper/ct0&gt;&gt;/etc/fstab
 vim /etc/fstab 
#/dev/vda1: UUID=&quot;3D3E-221D&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;vfat&quot; PARTLABEL=&quot;boot&quot; PARTUUID=&quot;e0e7d44b-d78f-4c27-808a-c859ce8ead64&quot;
UUID=&quot;3D3E-221D&quot;	/boot     vfat    rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro 0 2
#/dev/mapper/ct0: UUID=&quot;5f574106-322e-4f9f-8efd-c3615fcb237a&quot; UUID_SUB=&quot;0e96210f-49ac-4355-9237-dab1fb6eae93&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;btrfs&quot;
# rw,relatime,space_cache=v2,subvolid=256,subvol=/subvol-root
UUID=&quot;5f574106-322e-4f9f-8efd-c3615fcb237a&quot;	/         btrfs   defaults,noatime,ssd,discard,subvolid=256,subvol=/subvol_root 0 1

</code></pre><p>Install system packages:</p><pre><code>   66  emerge --ask sys-fs/cryptsetup
   67  emerge --ask sys-process/cronie
   68  emerge --ask app-admin/sysklogd
   69  emerge --ask sysfs/btrfs-progs
   70  emerge --ask sys-fs/btrfs-progs
   71  emerge --ask net-misc/dhcpcd
   72  emerge -av app-admin/sysklogd sys-fs/cryptsetup
   73  rc-update add sysklogd default
   74  rc-update add dhcpcd default
   76  echo GRUB_PLATFORMS=&quot;efi-64&quot; &gt;&gt; /etc/portage/make.conf
   77  emerge -av sys-boot/grub:2
   79  mkdir /boot/efi/
   80  ls /dev/disk/by-uuid/
   81  ls /dev/disk/by-uuid/ -l -h
   82  cat /etc/fstab 
   83  vim /etc/default/grub 
   84  vim /etc/default/grub 
   85  mount -a
   86  grub-install --target=x86_64-efi --boot-directory=/boot --efi-directory=/boot/efi/ --bootloader-id=Gentoo --debug
   87  grub-mkconfig -o /boot/grub/grub.cfg
   89  ls /boot/grub/
   90  ls /boot/grub/grub.cfg 
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/06/04/buildinggrub2undereuler/>Buildinggrub2undereuler</a></h1><span class=post-date>Jun 4, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Using repo:</p><pre><code>[root@localhost yum.repos.d]#  cat openEuler_x86_64.repo 
#Copyright (c) [2019] Huawei Technologies Co., Ltd.
#generic-repos is licensed under the Mulan PSL v1.
#You can use this software according to the terms and conditions of the Mulan PSL v1.
#You may obtain a copy of Mulan PSL v1 at:
#    http://license.coscl.org.cn/MulanPSL
#THIS SOFTWARE IS PROVIDED ON AN &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OF ANY KIND, EITHER EXPRESS OR
#IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT, MERCHANTABILITY OR FIT FOR A PARTICULAR
#PURPOSE.
#See the Mulan PSL v1 for more details.
[openEuler-everything]
name=openEuler-everything
baseurl=http://repo.huaweicloud.com/openeuler/openEuler-20.03-LTS/everything/x86_64/
enabled=1
gpgcheck=0
gpgkey=http://repo.huaweicloud.com/openeuler/openEuler-20.03-LTS/everything/x86_64/RPM-GPG-KEY-openEuler

[openEuler-EPOL]
name=openEuler-epol
baseurl=http://repo.huaweicloud.com/openeuler/openEuler-20.03-LTS/EPOL/x86_64/
enabled=1
gpgcheck=0

[openEuler-update]
name=openEuler-update
baseurl=http://repo.huaweicloud.com/openeuler/openEuler-20.03-LTS/update/x86_64/
enabled=1
gpgcheck=0
[root@localhost yum.repos.d]# pwd
/etc/yum.repos.d
# yum makecache
</code></pre><p>Install package:</p><pre><code>yum install -y elfutils-libelf-devel gcc gnu-efi gnu-efi-devel openssl-devel make git rpm-build
yum install -y rpmdevtools* tree
 rpmdev-setuptree
[root@localhost ~]# ls
anaconda-ks.cfg  rpmbuild
cd ~/rpmbuild/SOURCES
wget http://ftp.gnu.org/gnu/hello/hello-2.10.tar.gz
cd ~/rpmbuild/SPECS
vim hello.spec
</code></pre><p>content is:</p><pre><code>Name:     hello
Version:  2.10
Release:  1%{?dist}
Summary:  The &quot;Hello World&quot; program from GNU
Summary(zh_CN): GNU Hello World program
License:  GPLv3+
URL:      http://ftp.gnu.org/gnu/hello
Source0:  http://ftp.gnu.org/gnu/hello/%{name}-%{version}.tar.gz

BuildRequires:  gettext
Requires(post): info
Requires(preun): info

%description
The &quot;Hello World&quot; program, done with all bells and whistles of a proper FOSS
project, including configuration, build, internationalization, help files, etc.

%description -l zh_CN
The Hello World program contains all parts required by the FOSS project, including configuration, build, i18n, and help files.

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
make install DESTDIR=%{buildroot}
%find_lang %{name}
rm -f %{buildroot}/%{_infodir}/dir

%post
/sbin/install-info %{_infodir}/%{name}.info %{_infodir}/dir || :

%preun
if [ $1 = 0 ] ; then
/sbin/install-info --delete %{_infodir}/%{name}.info %{_infodir}/dir || :
fi

%files -f %{name}.lang
%doc AUTHORS ChangeLog NEWS README THANKS TODO
%license COPYING
%{_mandir}/man1/hello.1.*
%{_infodir}/hello.info.*
%{_bindir}/hello

%changelog
* Thu Dec 26 2019 Your Name &lt;youremail@xxx.xxx&gt; - 2.10-1
- Update to 2.10
* Sat Dec 3 2016 Your Name &lt;youremail@xxx.xxx&gt; - 2.9-1
- Update to 2.9
</code></pre><p>Building:</p><pre><code>rpmbuild -ba hello.spec 
# tree ~/rpmbuild/*RPMS
/root/rpmbuild/RPMS
└── x86_64
    ├── hello-2.10-1.x86_64.rpm
    ├── hello-debuginfo-2.10-1.x86_64.rpm
    └── hello-debugsource-2.10-1.x86_64.rpm
/root/rpmbuild/SRPMS
└── hello-2.10-1.src.rpm

</code></pre><p>Download the source code and install:</p><pre><code>rpm -ivh grub2-2.02-73.oe1.src.rpm 
cd rpmbuild/SPECS/
yum install -y  bison bzip2-devel dejavu-sans-fonts device-mapper-devel flex freetype-devel gettext-devel help2man libusb-devel ncurses-devel pesign rpm-devel texinfo xz-devel
$ vim /xxx/xx/grub.macros
%{4}./grub-mkimage -O %{1} -o %{2}.orig                         \\\
        -p /EFI/%{efi_vendor} -d grub-core ${GRUB_MODULES}      \
%{4}./grub-mkimage -O %{1} -o %{3}.orig                         \\\
        -p /EFI/BOOT -d grub-core ${GRUB_MODULES}
</code></pre><p>Change <code>.orig</code> to ``, so you could mkimage, and also remove the latter lines which use <code>pesign</code></p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/06/03/ongentooinstallation/>OnGentooInstallation</a></h1><span class=post-date>Jun 3, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=1-preparation>1. Preparation</h3><p>Start sshd:</p><pre><code>/etc/init.d/sshd start
passwd root
</code></pre><p>Remove the lvm via:</p><pre><code># dmsetup ls
# dmsetup remove xxxxxx
</code></pre><p>lsblk:</p><pre><code># lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0         7:0    0 479.7M  1 loop /mnt/livecd
sda           8:0    0   1.8T  0 disk 
sr0          11:0    1  1024M  0 rom  
sr1          11:1    1 527.4M  0 rom  /mnt/cdrom
zram0       253:0    0     0B  0 disk 
nvme0n1     259:0    0 476.9G  0 disk 
├─nvme0n1p1 259:1    0   512M  0 part 
├─nvme0n1p2 259:2    0     1G  0 part 
└─nvme0n1p3 259:3    0 475.4G  0 part 
</code></pre><p>Partition:</p><pre><code>livecd ~ # mkfs.vfat -F32 /dev/nvme0n1p1
mkfs.fat 4.2 (2021-01-31)
livecd ~ # mkswap /dev/nvme0n1p2
Setting up swapspace version 1, size = 1024 MiB (1073737728 bytes)
no label, UUID=5d36c31a-6fbf-4d04-84ac-9ee1efaf5712
livecd ~ # mkfs.ext4 /dev/nvme0n1p3
livecd ~ # swapon /dev/nvme0n1p2 
livecd ~ # mount /dev/nvme0n1p3 /mnt/gentoo
</code></pre><p>Get the stage3 file and untar it:</p><pre><code>wget https://mirrors.ustc.edu.cn/gentoo/releases/amd64/autobuilds/20240602T164858Z/stage3-amd64-desktop-openrc-20240602T164858Z.tar.xz
tar xpvf stage3-*.tar.xz --xattrs-include='*.*' --numeric-owner
</code></pre><p>enable makeopts:</p><pre><code># nano /etc/portage/make.conf
......
MAKEOPTS=&quot;-j20&quot;
......
</code></pre><p>Select mirror:</p><pre><code>mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/portage/make.conf
... select ustc.edu.cn
</code></pre><p>Copy the Portage repository settings:</p><pre><code>livecd /mnt/gentoo # mkdir -p /mnt/gentoo/etc/portage/repos.conf
livecd /mnt/gentoo # cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf
</code></pre><p>Copy the dns:</p><pre><code>cp --dereference /etc/resolv.conf /mnt/gentoo/etc/
</code></pre><p>Chroot to system:</p><pre><code>mount --types proc /proc /mnt/gentoo/proc
mount --rbind /sys /mnt/gentoo/sys
mount --make-rslave /mnt/gentoo/sys
mount --rbind /dev /mnt/gentoo/dev
mount --make-rslave /mnt/gentoo/dev
mount --bind /run /mnt/gentoo/run
mount --make-slave /mnt/gentoo/run
chroot /mnt/gentoo /bin/bash
source /etc/profile
export PS1=&quot;(chroot) ${PS1}&quot;
</code></pre><p>Mount EFI partition:</p><pre><code>livecd / # mount /dev/nvme0n1p1 /boot
</code></pre><p>Update Gentoo&rsquo;s ebuild :</p><pre><code>emerge-webrsync
</code></pre><p>Update using portage:</p><pre><code>emerge --ask --verbose --update --deep --newuse @world
</code></pre><p>Update to <code>Asia/Shanghai</code>:</p><pre><code>livecd / # echo &quot;Asia/Shanghai&quot;&gt;/etc/timezone
livecd / # emerge --config sys-libs/timezone-data
</code></pre><p>Edit the locale.gen:</p><pre><code># nano /etc/locale.gen
en_US.UTF-8 UTF-8
# locale-gen
</code></pre><p>Reload the setting:</p><pre><code>env-update
source /etc/profile
export PS1=&quot;(chroot) ${PS1}&quot;
</code></pre><h3 id=2-kernel>2. Kernel</h3><p>Edit cpu flags:</p><pre><code>#  emerge --ask app-portage/cpuid2cpuflags
#  cpuid2cpuflags
CPU_FLAGS_X86: aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sse sse2 sse3 sse4_1 sse4_2 ssse3
# nano /etc/portage/make.conf
CPU_FLAGS_X86=&quot;aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sse sse2 sse3 sse4_1 sse4_2 ssse3&quot;
</code></pre><p>Edit <code>/etc/portage/make.conf</code>, accept all of the license tips:</p><pre><code>ACCEPT_LICENSE=&quot;*&quot;
</code></pre><p>Install firmware and intel microcode:</p><pre><code>emerge --ask sys-kernel/linux-firmware  sys-firmware/intel-microcode
</code></pre><p>Change default editor from nano to vim:</p><pre><code>emerge -vj app-editors/vim
eselect editor list
eselect editor set 2
. /etc/profile
PS1=(chroot)$PS1
</code></pre><p>Install firmware/kernel/bootloader:</p><pre><code>mkdir -p /etc/portage/package.license
echo 'sys-kernel/linux-firmware linux-fw-redistributable no-source-code' &gt;/etc/portage/package.license/linux-firmware
# also install initramfs
echo 'sys-kernel/installkernel dracut' &gt;/etc/portage/package.use/installkernel
emerge -vj linux-firmware gentoo-kernel-bin grub
</code></pre><p>Edit <code>/etc/fstab</code>:</p><pre><code># efi partition
#/dev/nvme0n1p1: UUID=&quot;846A-BE3E&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;vfat&quot; PARTUUID=&quot;2e1058ce-0964-4624-be29-1ae87beae5fc&quot;
UUID=&quot;846A-BE3E&quot;         /boot/efi   vfat  rw,noatime,errors=remount-ro 0 2
# swap partition
#/dev/nvme0n1p2: UUID=&quot;5d36c31a-6fbf-4d04-84ac-9ee1efaf5712&quot; TYPE=&quot;swap&quot; PARTUUID=&quot;a35a309d-e60d-4b4e-8ef4-296962fda56b&quot;
UUID=&quot;5d36c31a-6fbf-4d04-84ac-9ee1efaf5712&quot;	none	swap  sw                           0 0
# root partition
#/dev/nvme0n1p3: UUID=&quot;2c24a130-dc28-40fd-ad92-2fd68c75229e&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;43320d2d-f849-4b45-a14c-7ac254b330df&quot;
UUID=&quot;2c24a130-dc28-40fd-ad92-2fd68c75229e&quot;  /           ext4  defaults,noatime             0 1
</code></pre><p>Install UEFI:</p><pre><code>grub-install --target=x86_64-efi --efi-directory=/boot/efi/ --bootloader-id=Gentoo
# notice swap file
sed -Ei &quot;/GRUB_CMDLINE_LINUX_DEFAULT/s/^#*(GRUB.*DEFAULT=).*$/\1\&quot;resume=UUID=$(blkid -o value /dev/nvme0n1p2 | head -1)\&quot;/&quot; /etc/default/grub
grub-mkconfig -o /boot/grub/grub.cfg
</code></pre><p>os-probe related:</p><pre><code>echo 'sys-boot/grub mount' &gt;/etc/portage/package.use/grub
emerge -vj os-prober
echo 'GRUB_DISABLE_OS_PROBER=false' &gt;&gt;/etc/default/grub
</code></pre><h3 id=configuration>Configuration</h3><p>Create user:</p><pre><code>passwd root
useradd -m -G usb,wheel kkk
passwd kkk
emerge -vj app-admin/sudo
visudo    # uncomment #%wheel
</code></pre><p>Install NetworkManager:</p><pre><code>echo &quot;net-wireless/wpa_supplicant dbus&quot; &gt;&gt;/etc/portage/package.use/nm
echo &quot;net-misc/openssh -bindist&quot; &gt;&gt;/etc/portage/package.use/nm
emerge -vj1 net-misc/openssh net-misc/networkmanager
emerge -On net-misc/networkmanager
rc-update add NetworkManager default
rc-update add sshd default
</code></pre><p>Install log service:</p><pre><code>emerge -vj app-admin/syslog-ng
rc-update add syslog-ng default
</code></pre><p>Reboot:</p><pre><code>sync
exit
umount -Rl /mnt/gentoo/{dev,proc,sys,}
reboot
</code></pre><h3 id=repository>repository</h3><p>via:</p><pre><code>emerge --ask app-eselect/eselect-repository
eselect repository list
eselect repository enable  zugaina
emaint sync -r zugaina

</code></pre><h3 id=usb-key-related>usb key related</h3><p>Format via:</p><pre><code>livecd ~ # lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0         7:0    0 479.7M  1 loop /mnt/livecd
sda           8:0    1  57.3G  0 disk 
├─sda1        8:1    1   1.3G  0 part 
├─sda2        8:2    1   512K  0 part 
└─sda3        8:3    1    56G  0 part 
sr0          11:0    1 527.4M  0 rom  /mnt/cdrom
zram0       253:0    0     0B  0 disk 
nvme0n1     259:0    0 953.9G  0 disk 
├─nvme0n1p1 259:1    0   480M  0 part 
└─nvme0n1p2 259:2    0 953.4G  0 part 
livecd ~ # parted -a optimal /dev/sda
GNU Parted 3.6
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) mklabel gpt                                                      
Warning: The existing disk label on /dev/sda will be destroyed and all data on this disk will be lost. Do you want to continue?
Yes/No? yes                                                               
(parted) mkpart primary fat32 0% 100%                                     
(parted) set 1 BOOT on                                                    
(parted) quit                                                             
Information: You may need to update /etc/fstab.

</code></pre><p>Create the gpg:</p><pre><code>livecd ~ # export GPG_TTY=$(tty)
livecd ~ # echo $(tty)
/dev/pts/0
livecd ~ # dd if=/dev/urandom bs=8388607 count=1 | gpg --symmetric --cipher-algo AES256 --output /tmp/efiboot/luks-key.gpg
gpg: directory '/root/.gnupg' created
1+0 records in
1+0 records out
8388607 bytes (8.4 MB, 8.0 MiB) copied, 6.76511 s, 1.2 MB/s

</code></pre><p>nvme ssd:</p><pre><code># parted -a optimal /dev/nvme0n1
GNU Parted 3.6
Using /dev/nvme0n1
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) unit s                                                           
(parted) print free                                                       
(parted) mkpart primary 2048s 2000409230s                                   
(parted) quit                                                             
Information: You may need to update /etc/fstab.
</code></pre><p>Create encrypted disk:</p><pre><code># gpg --decrypt /tmp/efiboot/luks-key.gpg | cryptsetup --cipher serpent-xts-plain64 --key-size 512 --hash whirlpool --key-file - luksFormat /dev/nvme0n1p1 
gpg: AES256.CFB encrypted data
gpg: encrypted with 1 passphrase
livecd ~ # cryptsetup luksDump /dev/nvme0n1p1

</code></pre><p>disk layout:</p><pre><code>livecd ~ # gpg --decrypt /tmp/efiboot/luks-key.gpg | cryptsetup --key-file - luksOpen  /dev/nvme0n1p1 gentoo
gpg: AES256.CFB encrypted data
gpg: encrypted with 1 passphrase
livecd ~ # ls /dev/mapper/
control  gentoo
livecd ~ # pvcreate /dev/mapper/gentoo
  Physical volume &quot;/dev/mapper/gentoo&quot; successfully created.
livecd ~ # vgcreate vg1 /dev/mapper/gentoo
  Volume group &quot;vg1&quot; successfully created
livecd ~ # grep MemTotal /proc/meminfo
MemTotal:       15954144 kB
livecd ~ # lvcreate --size 8G --name swap vg1
  Logical volume &quot;swap&quot; created.
livecd ~ # lvcreate --size 80G --name root vg1
  Logical volume &quot;root&quot; created.
livecd ~ # lvcreate --extents 95%FREE --name home vg1
  Logical volume &quot;home&quot; created.
livecd ~ # pvdisplay 
  --- Physical volume ---
  PV Name               /dev/mapper/gentoo
  VG Name               vg1
  PV Size               953.85 GiB / not usable &lt;1.32 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              244186
  Free PE               11083
  Allocated PE          233103
  PV UUID               xBgj1j-1e3g-iaT0-esba-jJ3f-EO3m-Ty6wgY
   
livecd ~ # vgdisplay 
  --- Volume group ---
  VG Name               vg1
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  4
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                3
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               953.85 GiB
  PE Size               4.00 MiB
  Total PE              244186
  Alloc PE / Size       233103 / &lt;910.56 GiB
  Free  PE / Size       11083 / 43.29 GiB
  VG UUID               YUdAbE-MnJA-54GY-aQkb-Kp9G-P52q-Wl3Uey
   
livecd ~ # lvdisplay 
  --- Logical volume ---
  LV Path                /dev/vg1/swap
  LV Name                swap
  VG Name                vg1
  LV UUID                OKxWa1-NBN2-F6zx-E1qQ-wPQJ-2lmP-7abjG1
  LV Write Access        read/write
  LV Creation host, time livecd, 2024-06-03 12:41:29 +0000
  LV Status              available
  # open                 0
  LV Size                8.00 GiB
  Current LE             2048
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           252:1
   
  --- Logical volume ---
  LV Path                /dev/vg1/root
  LV Name                root
  VG Name                vg1
  LV UUID                yAMQV4-sNI7-zuY8-ZkDX-k53i-dxoF-PsvE4O
  LV Write Access        read/write
  LV Creation host, time livecd, 2024-06-03 12:41:43 +0000
  LV Status              available
  # open                 0
  LV Size                80.00 GiB
  Current LE             20480
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           252:2
   
  --- Logical volume ---
  LV Path                /dev/vg1/home
  LV Name                home
  VG Name                vg1
  LV UUID                APZd1G-qGe1-9t5c-AhBh-pUKt-Dit8-D2WTHd
  LV Write Access        read/write
  LV Creation host, time livecd, 2024-06-03 12:41:48 +0000
  LV Status              available
  # open                 0
  LV Size                &lt;822.56 GiB
  Current LE             210575
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           252:3
livecd ~ # vgchange --available y
  3 logical volume(s) in volume group &quot;vg1&quot; now active
livecd ~ # ls /dev/mapper
control  gentoo  vg1-home  vg1-root  vg1-swap
livecd ~ # vgchange --available y
  3 logical volume(s) in volume group &quot;vg1&quot; now active
livecd ~ # ls /dev/mapper
control  gentoo  vg1-home  vg1-root  vg1-swap
livecd ~ # mkswap -L &quot;swap&quot; /dev/mapper/vg1-swap
Setting up swapspace version 1, size = 8 GiB (8589930496 bytes)
LABEL=swap, UUID=b8653482-926c-4e26-89fb-55f52f3fca9f
livecd ~ # mkfs.ext4 -L &quot;root&quot; /dev/mapper/vg1-root
mke2fs 1.47.0 (5-Feb-2023)
Creating filesystem with 20971520 4k blocks and 5242880 inodes
Filesystem UUID: 030ae853-ad94-4fe5-a5a8-340aaeb54a6c
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (131072 blocks): done
Writing superblocks and filesystem accounting information: done   

livecd ~ # mkfs.ext4 -m 0 -L &quot;home&quot; /dev/mapper/vg1-home
mke2fs 1.47.0 (5-Feb-2023)
Creating filesystem with 215628800 4k blocks and 53911552 inodes
Filesystem UUID: f8534406-cdcb-4538-8397-2480d96a306b
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
	102400000, 214990848

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (262144 blocks): done
Writing superblocks and filesystem accounting information: done     

livecd ~ # swapon -v /dev/mapper/vg1-swap
swapon: /dev/mapper/vg1-swap: found signature [pagesize=4096, signature=swap]
swapon: /dev/mapper/vg1-swap: pagesize=4096, swapsize=8589934592, devsize=8589934592
swapon /dev/mapper/vg1-swap
livecd ~ # mount -v -t ext4 /dev/mapper/vg1-root /mnt/gentoo
mount: /dev/mapper/vg1-root mounted on /mnt/gentoo.
livecd ~ # blkid /dev/sda1 /dev/nvme0n1p1 
/dev/sda1: UUID=&quot;81A6-BFB2&quot; BLOCK_SIZE=&quot;512&quot; TYPE=&quot;vfat&quot; PARTLABEL=&quot;primary&quot; PARTUUID=&quot;be83585f-0239-4b8a-8931-674aaaadb69d&quot;
/dev/nvme0n1p1: UUID=&quot;ddc06372-5d72-49a0-b617-b97128f8e3e6&quot; TYPE=&quot;crypto_LUKS&quot; PARTLABEL=&quot;primary&quot; PARTUUID=&quot;3635503c-78f0-44ce-8982-633ca20723ff&quot;

</code></pre><p>Receive the gpg key:</p><pre><code>gpg --keyserver  pgp.mit.edu --recv-key 2D182910
</code></pre><p>fetch the stage 3 file:</p><pre><code># cd /mnt/gentoo
# wget https://mirrors.ustc.edu.cn/gentoo/releases/amd64/autobuilds/20240602T164858Z/stage3-amd64-desktop-openrc-20240602T164858Z.tar.xz
</code></pre><p>untar the stage3 file:</p><pre><code>tar xvJpf stage3-amd64-*.tar.xz --xattrs-include='*.*' --numeric-owner
rm -f stage3-amd64-desktop-openrc-20240602T164858Z.tar.xz
</code></pre><p>Edit the bashrc:</p><pre><code>livecd /mnt/gentoo # cat /mnt/gentoo/root/.bashrc 
export NUMCPUS=$(nproc)
export NUMCPUSPLUSONE=$(( NUMCPUS + 1 ))
export MAKEOPTS=&quot;-j${NUMCPUSPLUSONE} -l${NUMCPUS}&quot;
export EMERGE_DEFAULT_OPTS=&quot;--jobs=${NUMCPUSPLUSONE} --load-average=${NUMCPUS}&quot;
</code></pre><p>copy the <code>bashrc_profile</code>:</p><pre><code>cp -v /mnt/gentoo/etc/skel/.bash_profile /mnt/gentoo/root/
</code></pre><p>edit the make.conf:</p><pre><code>livecd /mnt/gentoo # cat /mnt/gentoo/etc/portage/make.conf 
# These settings were set by the catalyst build script that automatically
# built this stage.
# Please consult /usr/share/portage/config/make.conf.example for a more
# detailed example.
COMMON_FLAGS=&quot;-march=native -O2 -pipe&quot;
CFLAGS=&quot;${COMMON_FLAGS}&quot;
CXXFLAGS=&quot;${COMMON_FLAGS}&quot;
FCFLAGS=&quot;${COMMON_FLAGS}&quot;
FFLAGS=&quot;${COMMON_FLAGS}&quot;

# NOTE: This stage was built with the bindist Use flag enabled

# This sets the language of build output to English.
# Please keep this setting intact when reporting bugs.
#LC_MESSAGES=C.utf8

# Note: MAKEOPTS and EMERGE_DEFAULT_OPTS are set in .bashrc

# The following licence is required, in addition to @FREE, for GNOME.
ACCEPT_LICENSE=&quot;CC-Sampling-Plus-1.0&quot;

# WARNING: Changing your CHOST is not something that should be done lightly.
# Please consult http://www.gentoo.org/doc/en/change-chost.xml before changing.
CHOST=&quot;x86_64-pc-linux-gnu&quot;

# Use the 'stable' branch - 'testing' no longer required for Gnome 3.
# NB, amd64 is correct for both Intel and AMD 64-bit CPUs
ACCEPT_KEYWORDS=&quot;amd64&quot;

# Additional USE flags supplementary to those specified by the current profile.
USE=&quot;&quot;
CPU_FLAGS_X86=&quot;mmx mmxext sse sse2&quot;

# Important Portage directories.
PORTDIR=&quot;/var/db/repos/gentoo&quot;
DISTDIR=&quot;/var/cache/distfiles&quot;
PKGDIR=&quot;/var/cache/binpkgs&quot;

# This sets the language of build output to English.
# Please keep this setting intact when reporting bugs.
LC_MESSAGES=C

# Turn on logging - see http://gentoo-en.vfose.ru/wiki/Gentoo_maintenance.
PORTAGE_ELOG_CLASSES=&quot;info warn error log qa&quot;
# Echo messages after emerge, also save to /var/log/portage/elog
PORTAGE_ELOG_SYSTEM=&quot;echo save&quot;

# Ensure elogs saved in category subdirectories.
# Build binary packages as a byproduct of each emerge, a useful backup.
FEATURES=&quot;split-elog buildpkg&quot;

# Settings for X11
VIDEO_CARDS=&quot;intel i965&quot;
INPUT_DEVICES=&quot;libinput&quot;
</code></pre><p>Select ustc for the mirror, thus make.conf should be like following:</p><pre><code>livecd /mnt/gentoo # tail /mnt/gentoo/etc/portage/make.conf 
# Ensure elogs saved in category subdirectories.
# Build binary packages as a byproduct of each emerge, a useful backup.
FEATURES=&quot;split-elog buildpkg&quot;

# Settings for X11
VIDEO_CARDS=&quot;intel i965&quot;
INPUT_DEVICES=&quot;libinput&quot;

GENTOO_MIRRORS=&quot;https://mirrors.ustc.edu.cn/gentoo/ \
    rsync://rsync.mirrors.ustc.edu.cn/gentoo/&quot;

</code></pre><p>Edit the <code>repos.conf/gentoo.conf</code>:</p><pre><code>livecd /mnt/gentoo # cp -v /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf


livecd /mnt/gentoo # cat /mnt/gentoo/etc/portage/repos.conf/gentoo.conf 
[DEFAULT]
main-repo = gentoo

[gentoo]
location = /var/db/repos/gentoo
sync-type = webrsync
sync-uri = rsync://rsync.mirrors.ustc.edu.cn/gentoo-portage
auto-sync = yes
sync-rsync-verify-jobs = 1
sync-rsync-verify-metamanifest = yes
sync-rsync-verify-max-age = 3
sync-openpgp-key-path = /usr/share/openpgp-keys/gentoo-release.asc
sync-openpgp-keyserver = hkps://keys.gentoo.org
sync-openpgp-key-refresh-retry-count = 40
sync-openpgp-key-refresh-retry-overall-timeout = 1200
sync-openpgp-key-refresh-retry-delay-exp-base = 2
sync-openpgp-key-refresh-retry-delay-max = 60
sync-openpgp-key-refresh-retry-delay-mult = 4
sync-webrsync-verify-signature = yes

</code></pre><p>Edit the dns file:</p><pre><code># cat /mnt/gentoo/etc/resolv.conf 
nameserver 223.5.5.5
</code></pre><p>Prepare for chroot:</p><pre><code>livecd /mnt/gentoo # mount -v -t proc none /mnt/gentoo/proc
mount: none mounted on /mnt/gentoo/proc.
livecd /mnt/gentoo # mount -v --rbind /sys /mnt/gentoo/sys
mount: /sys bound on /mnt/gentoo/sys.
livecd /mnt/gentoo # mount -v --rbind /dev /mnt/gentoo/dev
mount: /dev bound on /mnt/gentoo/dev.
livecd /mnt/gentoo # mount -v --make-rslave /mnt/gentoo/sys
livecd /mnt/gentoo # mount -v --make-rslave /mnt/gentoo/dev
</code></pre><p>chroot in:</p><pre><code>livecd /mnt/gentoo # chroot /mnt/gentoo /bin/bash
livecd / # source /etc/profile
livecd / # export PS1=&quot;(chroot) $PS1
</code></pre><p>Sync and select profile:</p><pre><code> emaint sync --auto
 eselect profile list
 eselect profile set &quot;default/linux/amd64/17.1&quot;
 emerge --info
 grep -i useflag /var/db/repos/gentoo/profiles/use.desc
 emerge --ask --verbose --oneshot portage

</code></pre><p>set timezone and locale:</p><pre><code> echo &quot;Asia/Shanghai&quot;&gt;/etc/timezone
 emerge -v --config sys-libs/timezone-data
 nano -w /etc/locale.gen
 locale-gen
 eselect locale list
 eselect locale set &quot;C&quot;
 env-update &amp;&amp; source /etc/profile &amp;&amp; export PS1=&quot;(chroot) $PS1&quot;
</code></pre><p>set cpu flags in make.conf:</p><pre><code>emerge --verbose --oneshot app-portage/cpuid2cpuflags
cpuid2cpuflags
nano -w /etc/portage/make.conf
</code></pre><p>Update using portage:</p><pre><code>emerge --ask --verbose --update --deep --newuse @world
</code></pre><p>build kernel:</p><pre><code>(chroot) livecd / # mkdir -p -v /etc/portage/package.license
mkdir: created directory '/etc/portage/package.license'
(chroot) livecd / # touch /etc/portage/package.license/zzz_via_autounmas
echo &quot;sys-kernel/linux-firmware linux-fw-redistributable no-source-code&quot; &gt;&gt; /etc/portage/package.license/linux-firmware
emerge --ask --verbose sys-kernel/gentoo-sources
emerge --ask --verbose sys-kernel/linux-firmware
(chroot) livecd / # readlink -v /usr/src/linux
readlink: /usr/src/linux: No such file or directory
(chroot) livecd / # eselect kernel list
Available kernel symlink targets:
  [1]   linux-6.6.30-gentoo
(chroot) livecd / # eselect kernel set 1
(chroot) livecd / # readlink -v /usr/src/linux
linux-6.6.30-gentoo
emerge --ask --verbose dev-vcs/git 
 # cat /etc/portage/repos.conf/waffle-builds.conf
[waffle-builds]
 
# Various utility ebuilds for Gentoo on EFI
# Maintainer: sakaki (sakaki@deciban.com)
 
location = /usr/local/portage/waffle-builds
sync-type = git
sync-uri = https://github.com/FlyingWaffleDev/waffle-builds.git
priority = 50
auto-sync = yes
(chroot) livecd / # emaint sync --repo waffle-builds
(chroot) livecd / # echo &quot;*/*::waffle-builds ~amd64&quot;&gt;&gt; /etc/portage/package.accept_keywords/waffle-builds-repo

</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/05/21/workingtipsonfogcustomization/>WorkingTipsOnFOGCustomization</a></h1><span class=post-date>May 21, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Create vm machine for development:</p><pre><code>qemu-img create -f qcow2 -b /media/sda/qcow2/ubuntu2404.qcow2 -F qcow2 zzzz_modifiedFOG.qcow2
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/05/17/mdbook/>mdbook</a></h1><span class=post-date>May 17, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Install via:</p><pre><code>sudo pacman -S mdbook
$ yay mdbook-toc
</code></pre><p>For using cargo tuna mirror site, do following modifications:</p><pre><code>$ vim  ~/.cargo/config 
[source.crates-io]
replace-with = 'tuna'

[source.tuna]
registry = &quot;https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git&quot;
</code></pre><p>Install pdf generation and pdf outline:</p><pre><code>$ cargo install mdbook-pdf
$ pip install --break-system-packages mdbook-pdf-outline
$ vim ~/.zshrc
...
export PATH=/home/dash/.cargo/bin:/home/dash/.local/bin:$PATH
</code></pre><p>Now add following definition to your book:</p><pre><code>[preprocessor.toc]
command = &quot;mdbook-toc&quot;
renderer = [&quot;html&quot;]

[output.html]

[output.pdf]
## Set for auto-retrying if failed to generate PDF.
# trying-times = 1
## This backend only support latest Chromium based browsers, not Safari and Firefox currently.
## If needed, please specify the full path.
## If you specify the wrong binary, chances are that there will be a timeout error.
# browser-binary-path = &quot;&quot;
## Assign the static hosting site url so that relative links outside the book can be fixed.
#static_site_url = &quot;https://aye10032.gitbook.io/computernetwork/&quot;
## Check Chrome Devtools Protocol Docs for the explanation of the following params:
## https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-printToPDF
landscape = false
display-header-footer = true
print-background = true
theme = &quot;&quot;
scale = 0.8
paper-width = 8
paper-height = 10
margin-top = 0.5
margin-bottom = 0.5
margin-left = 0.5
margin-right = 0.5
page-ranges = &quot;&quot;
ignore-invalid-page-ranges = false
header-template = &quot;&lt;h3 style='font-size:8px; margin-left: 48%' class='title'&gt;&lt;/h3&gt;&quot;
footer-template = &quot;&lt;p style='font-size:10px; margin-left: 48%'&gt;&lt;span class='pageNumber'&gt;&lt;/span&gt; / &lt;span class='totalPages'&gt;&lt;/span&gt;&lt;/p&gt;&quot;
prefer-css-page-size = true

[output.pdf-outline]
like-wkhtmltopdf = true
</code></pre><p>Generate book pdf:</p><pre><code>$ mdbook pdf
$ ls -l -h book/pdf-outline/*.pdf
-rw-r--r-- 1 dash root 8.8M May 17 10:00 book/pdf-outline/output.pdf
</code></pre></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class="page-item disabled"><a class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class="page-item active"><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/240/>240</a></li><li class=page-item><a href=/page/2/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/240/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>