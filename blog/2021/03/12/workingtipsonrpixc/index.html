<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>WorkingTipsOnRPIXC &middot; Dash</title>

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/poole.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124">
  <link rel="stylesheet" href="https://purplepalmdash.github.io/css/highlight/googlecode.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script type="text/javascript" src="/js/html2canvas.js"></script>
  <script type='text/javascript'>
  function genPostShot() { 
          var rightNow = new Date();
          var imageName = rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");
          imageName += '.jpg'
          html2canvas(document.getElementsByClassName('post'), {
              background :'#FFFFFF',
              onrendered: function(canvas) {
  		
          	$('#test').attr('href', canvas.toDataURL("image/jpeg"));
          	$('#test').attr('download',imageName);
          	$('#test')[0].click();
              }
          });
  }; 
  
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124">
  <link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel="icon">

  
  
  
  
  <meta name="description" content="WorkingTipsOnRPIXC">
  <meta name="keywords" content="Technology">
  
  
</head>
<body class="theme-base-0c">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="http://purplepalmdash.github.io/images/mylogo.jpeg" alt="gravatar">
      <h1><a href="http://purplepalmdash.github.io/">Get busy living, or get busy dying.</a></h1>
      <a href="http://purplepalmdash.github.io/"><p>Dash</p></a>
    </div>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/post/">All Posts</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/technology/">Technology</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/life/">Life</a></li>
      
      <li class="sidebar-nav-item"><a href="http://purplepalmdash.github.io/categories/linuxtips/">LinuxTips</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/purplepalmdash"><i class="fa fa-github-square fa-3x"></i></a>
      
      <a href="https://cn.linkedin.com/in/yang-feipeng-1b909319"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://plus.google.com/u/0/106572959364703833986"><i class="fa fa-google-plus-square fa-3x"></i></a>
      <a href="https://www.facebook.com/yang.feipeng"><i class="fa fa-facebook-square fa-3x"></i></a>
      <a href="https://twitter.com/dashwillfly"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      </li>
    </ul>

    

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>WorkingTipsOnRPIXC</h1>
    <p align="right">
    <a href="javascript:genPostShot()">
	    TurnToJPG --> <i class="fa fa-camera-retro fa-2x"></i>
    </a>
    <a id="test"></a>
    </p>
    <hr>
    <span class="post-date">Mar 12, 2021 
    
    <br/>
    
          <a class="a_cat" href="http://purplepalmdash.github.io/categories/technology">Technology</a>
      
      

    
    </span>
      <div id="_toc" class="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#目标">目标</a></li>
        <li><a href="#系统准备">系统准备</a></li>
        <li><a href="#初次登陆">初次登陆</a></li>
        <li><a href="#虚拟机开发环境准备">虚拟机开发环境准备</a></li>
        <li><a href="#虚拟机系统安装">虚拟机系统安装</a></li>
        <li><a href="#xc适配">XC适配</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    <h3 id="目标">目标</h3>
<p>基于树莓派的arm64快速验证平台。</p>
<h3 id="系统准备">系统准备</h3>
<p>Ubuntu官网下载到<code>Ubuntu 20.04.2 LTS</code> 64位镜像:</p>
<p><a href="https://ubuntu.com/download/raspberry-pi">https://ubuntu.com/download/raspberry-pi</a></p>
<p><img src="/images/2021_03_12_09_45_02_1212x332.jpg" alt="/images/2021_03_12_09_45_02_1212x332.jpg"></p>
<p>插入tf卡，烧写img文件至tf卡中, Linux 命令为:</p>
<pre><code> $ sudo dd if=./ubuntu-20.04.2-preinstalled-server-arm64+raspi.img of=/dev/sdd bs=1M &amp;&amp; sudo sync
记录了3108+1 的读入
记录了3108+1 的写出
3259499520字节（3.3 GB，3.0 GiB）已复制，79.1856 s，41.2 MB/s
</code></pre><p>Windows下可自行下载rpi镜像烧写软件以完成烧写操作。</p>
<h3 id="初次登陆">初次登陆</h3>
<p>如果具备mini-hdmi转接线及鼠标，则可外接显示器用于登陆RPI。  <br>
如果不具备显示器，则可以通过接入网络来远程登陆RPI，登陆到局域网段的路由器上查看rpi获取到的Ip地址即可。</p>
<p>例如， 在路由器上获取到RPI IP地址:</p>
<pre><code>$ cat /var/lib/misc/dnsmasq.leases
1615556943 dc:a6:32:e2:0b:44 10.137.149.171 ubuntu ff:dc:6b:56:57:00:02:00:00:ab:11:b2:87:a0:99:d0:fb:b1:ce
</code></pre><p>而后用ssh登陆, 默认用户名/密码为ubuntu/ubuntu，初次登陆后会强制要求更改:</p>
<pre><code>$ ssh ubuntu@10.137.149.171
。。。。

WARNING: Your password has expired.
You must change your password now and login again!
Changing password for ubuntu.
Current password: 
New password: 
Retype new password: 
passwd: password updated successfully
Connection to 10.137.149.171 closed.
$ ssh ubuntu@10.137.149.171
ubuntu@10.137.149.171's password: 
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-1028-raspi aarch64)
</code></pre><h3 id="虚拟机开发环境准备">虚拟机开发环境准备</h3>
<p>安装基本桌面, 选择lightdm:</p>
<pre><code>$ sudo apt-get install lxde virt-manager tightvncserver net-tools
</code></pre><p><img src="/images/2021_03_12_10_12_41_512x417.jpg" alt="/images/2021_03_12_10_12_41_512x417.jpg"></p>
<p>开启vnc:</p>
<pre><code>$ vncserver
You will require a password to access your desktops.

Password: 
Verify:   
Would you like to enter a view-only password (y/n)? y
Password: 
Verify:   

New 'X' desktop is ubuntu:1

Creating default startup script /home/ubuntu/.vnc/xstartup
Starting applications specified in /home/ubuntu/.vnc/xstartup
Log file is /home/ubuntu/.vnc/ubuntu:1.log
</code></pre><p>此时需要先关闭正在运行的vncserver, 配置默认桌面环境后再重新创建:</p>
<pre><code>ubuntu@ubuntu:~$ vncserver -kill :1
Killing Xtightvnc process ID 30773
ubuntu@ubuntu:~$ vim ~/.vnc/xstartup 
#!/bin/sh
exec startlxde

ubuntu@ubuntu:~$ vncserver

New 'X' desktop is ubuntu:1

Starting applications specified in /home/ubuntu/.vnc/xstartup
Log file is /home/ubuntu/.vnc/ubuntu:1.log

</code></pre><p>此时可以使用vncviewer登陆:</p>
<p><img src="/images/2021_03_12_10_29_49_737x234.jpg" alt="/images/2021_03_12_10_29_49_737x234.jpg"></p>
<p>开启libvirtd权限:</p>
<pre><code>$ sudo systemctl enable libvirtd
$ sudo systemctl start libvirtd
$  sudo usermod -a -G kvm,libvirt  ubuntu
</code></pre><p>此时需重启rpi后，重新登陆/开启vnc后，验证virt-manager的可用性:</p>
<p><img src="/images/2021_03_12_10_38_23_792x442.jpg" alt="/images/2021_03_12_10_38_23_792x442.jpg"></p>
<h3 id="虚拟机系统安装">虚拟机系统安装</h3>
<p><img src="/images/2021_03_12_10_46_47_632x356.jpg" alt="/images/2021_03_12_10_46_47_632x356.jpg"></p>
<p><img src="/images/2021_03_12_10_47_23_497x497.jpg" alt="/images/2021_03_12_10_47_23_497x497.jpg"></p>
<p><img src="/images/2021_03_12_10_47_34_386x250.jpg" alt="/images/2021_03_12_10_47_34_386x250.jpg"></p>
<p><img src="/images/2021_03_12_10_47_50_428x281.jpg" alt="/images/2021_03_12_10_47_50_428x281.jpg"></p>
<p><img src="/images/2021_03_12_10_48_06_531x525.jpg" alt="/images/2021_03_12_10_48_06_531x525.jpg"></p>
<p>进入到安装界面后(All-In-One安装)：</p>
<p><img src="/images/2021_03_12_10_48_56_657x395.jpg" alt="/images/2021_03_12_10_48_56_657x395.jpg"></p>
<p>安装过程:</p>
<p><img src="/images/2021_03_12_10_54_08_682x525.jpg" alt="/images/2021_03_12_10_54_08_682x525.jpg"></p>
<p>安装完毕后可以备份一下初始化镜像以便后续使用:</p>
<pre><code>$ sudo virsh dumpxml ubuntu20.04 | grep qcow2
      &lt;driver name='qemu' type='qcow2'/&gt;
      &lt;source file='/var/lib/libvirt/images/ubuntu20.04.qcow2'/&gt;
ubuntu@ubuntu:~$ sudo cp /var/lib/libvirt/images/ubuntu20.04.qcow2 .

</code></pre><p>后续开始部署RONG:</p>
<p><img src="/images/2021_03_12_11_57_01_966x589.jpg" alt="/images/2021_03_12_11_57_01_966x589.jpg"></p>
<p>部署完毕后资源占用情况:</p>
<pre><code>root@node:/home/test/Rong# free -m
              total        used        free      shared  buff/cache   available
Mem:           5909        1790         132           2        3987        4205
Swap:             0           0           0
root@node:/home/test/Rong# df -h
Filesystem               Size  Used Avail Use% Mounted on
udev                     2.9G     0  2.9G   0% /dev
tmpfs                    591M  2.5M  589M   1% /run
/dev/mapper/vgnode-root   24G   13G   12G  52% /
</code></pre><h3 id="xc适配">XC适配</h3>
<p>选择国产操作系统ISO用于安装：</p>
<p><img src="/images/2021_03_12_12_09_23_546x515.jpg" alt="/images/2021_03_12_12_09_23_546x515.jpg"></p>
<p><img src="/images/2021_03_12_12_10_04_505x320.jpg" alt="/images/2021_03_12_12_10_04_505x320.jpg"></p>
<p><img src="/images/2021_03_12_12_10_19_501x256.jpg" alt="/images/2021_03_12_12_10_19_501x256.jpg"></p>
<p><img src="/images/2021_03_12_12_10_37_507x382.jpg" alt="/images/2021_03_12_12_10_37_507x382.jpg"></p>
<p>安装界面：</p>
<p><img src="/images/2021_03_12_12_11_29_648x177.jpg" alt="/images/2021_03_12_12_11_29_648x177.jpg"></p>
<p><img src="/images/2021_03_12_12_13_08_754x293.jpg" alt="/images/2021_03_12_12_13_08_754x293.jpg"></p>
<p><img src="/images/2021_03_12_12_13_25_669x176.jpg" alt="/images/2021_03_12_12_13_25_669x176.jpg"></p>
<p><img src="/images/2021_03_12_12_16_03_704x343.jpg" alt="/images/2021_03_12_12_16_03_704x343.jpg"></p>
<p><img src="/images/2021_03_12_12_16_21_676x294.jpg" alt="/images/2021_03_12_12_16_21_676x294.jpg"></p>
<p><img src="/images/2021_03_12_12_16_36_678x192.jpg" alt="/images/2021_03_12_12_16_36_678x192.jpg"></p>
<p><img src="/images/2021_03_12_12_16_49_686x245.jpg" alt="/images/2021_03_12_12_16_49_686x245.jpg"></p>
<p><img src="/images/2021_03_12_12_17_00_672x242.jpg" alt="/images/2021_03_12_12_17_00_672x242.jpg"></p>
<p><img src="/images/2021_03_12_12_17_19_692x218.jpg" alt="/images/2021_03_12_12_17_19_692x218.jpg"></p>
<p><img src="/images/2021_03_12_12_17_39_684x297.jpg" alt="/images/2021_03_12_12_17_39_684x297.jpg"></p>
<p><img src="/images/2021_03_12_12_17_53_637x171.jpg" alt="/images/2021_03_12_12_17_53_637x171.jpg"></p>
<p><img src="/images/2021_03_12_12_18_08_647x302.jpg" alt="/images/2021_03_12_12_18_08_647x302.jpg"></p>
<p><img src="/images/2021_03_12_12_18_26_676x147.jpg" alt="/images/2021_03_12_12_18_26_676x147.jpg"></p>
<p><img src="/images/2021_03_12_12_18_49_698x344.jpg" alt="/images/2021_03_12_12_18_49_698x344.jpg"></p>
<p><img src="/images/2021_03_12_12_19_03_659x170.jpg" alt="/images/2021_03_12_12_19_03_659x170.jpg"></p>
<p>外面ping:</p>
<pre><code>ubuntu@ubuntu:~$ ping 192.168.122.30
PING 192.168.122.30 (192.168.122.30) 56(84) bytes of data.
64 bytes from 192.168.122.30: icmp_seq=1 ttl=64 time=0.941 ms
64 bytes from 192.168.122.30: icmp_seq=2 ttl=64 time=0.499 ms

</code></pre><p>8-&gt; 设置root password.</p>
<p>如果无其他设置，则直接安装</p>
<p><img src="/images/2021_03_12_12_21_21_705x347.jpg" alt="/images/2021_03_12_12_21_21_705x347.jpg"></p>
<p>安装过程:</p>
<p><img src="/images/2021_03_12_12_22_16_651x345.jpg" alt="/images/2021_03_12_12_22_16_651x345.jpg"></p>
<p>安装完毕后，登陆:</p>
<pre><code>$ ssh root@192.168.122.30
The authenticity of host '192.168.122.30 (192.168.122.30)' can't be established.
ECDSA key fingerprint is SHA256:wC8hcKiDjbz1+l9MAIUWMZju0evX4ZAIQjz+GPzEL4I.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.122.30' (ECDSA) to the list of known hosts.

Authorized users only. All activities may be monitored and reported.
root@192.168.122.30's password: 

Authorized users only. All activities may be monitored and reported.
Web console: https://localhost:9090/ or https://192.168.122.30:9090/

Last failed login: Thu Apr  2 03:46:11 CST 2020 from 192.168.122.1 on ssh:notty
There was 1 failed login attempt since the last successful login.
[root@localhost ~]# 

</code></pre><p>部署完RONG后，检查:</p>
<pre><code>[root@localhost Rong]# kubectl get node
NAME     STATUS   ROLES    AGE     VERSION
test01   Ready    master   9m48s   v1.18.8
[root@localhost Rong]# uname -a
Linux localhost.localdomain 4.19.90-17.ky10.aarch64 #1 SMP Sun Jun 28 14:27:40 CST 2020 aarch64 aarch64 aarch64 GNU/Linux
[root@localhost Rong]# cat /etc/issue

Authorized users only. All activities may be monitored and reported.

</code></pre><p>pod对应的指标:</p>
<pre><code>[root@localhost ~]# kubectl get pods --all-namespaces
NAMESPACE     NAME                                          READY   STATUS              RESTARTS   AGE
kube-system   calico-kube-controllers-f874b4f5f-846zc       0/1     CrashLoopBackOff    12         24m
kube-system   calico-node-4d869                             0/1     CrashLoopBackOff    12         25m
kube-system   coredns-dff8fc7d-f2n26                        0/1     ContainerCreating   0          23m
kube-system   dns-autoscaler-7b85bccb5f-264cz               0/1     ContainerCreating   0          23m
kube-system   kube-apiserver-test01                         1/1     Running             1          28m
kube-system   kube-controller-manager-test01                1/1     Running             1          28m
kube-system   kube-proxy-q6mnw                              1/1     Running             1          28m
kube-system   kube-scheduler-test01                         1/1     Running             1          28m
kube-system   kubernetes-dashboard-674bb5ff47-mw97w         0/1     ContainerCreating   0          23m
kube-system   kubernetes-metrics-scraper-54fbb4d595-64b6j   0/1     ContainerCreating   0          23m
kube-system   metrics-server-757968d55d-62czd               0/2     ContainerCreating   0          21m
kube-system   tiller-deploy-75dc954ffd-psj68                0/1     ContainerCreating   0          22m
</code></pre><p>同样的vm在华为的HI1616机器上表现正常。可见YINHE 麒麟 V10的系统bug较多，可能未曾适配过完整的硬件列表。</p>

  </div>
  
</div>






<script src="http://purplepalmdash.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

