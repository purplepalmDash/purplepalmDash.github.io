<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>TipsOnArm64K8s &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><meta name=description content="TipsOnArm64K8s"><meta name=keywords content="Linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=post><h1>TipsOnArm64K8s</h1><p align=right><a href=javascript:genPostShot()>TurnToJPG --> <i class="fa fa-camera-retro fa-2x"></i></a><a id=test></a></p><hr><span class=post-date>Oct 19, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><div id=_toc class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#系统安装>系统安装</a></li><li><a href=#配置系统>配置系统</a></li><li><a href=#镜像准备>镜像准备</a></li></ul></li></ul></nav></div><h3 id=系统安装>系统安装</h3><p>镜像为<code>ubuntu16.04.3-server-arm64.iso</code>, 安装盘用于安装系统,
预先需要配置为光盘启动:</p><p><img src=/images/2018_10_19_10_32_17_425x261.jpg alt=/images/2018_10_19_10_32_17_425x261.jpg></p><p>安装引导界面， 选择HWE Kernel：</p><p><img src=/images/2018_10_19_10_34_10_603x406.jpg alt=/images/2018_10_19_10_34_10_603x406.jpg></p><p>选择"Install Ubuntu Server&rdquo;:</p><p><img src=/images/2018_10_19_10_34_55_524x254.jpg alt=/images/2018_10_19_10_34_55_524x254.jpg></p><p>语言:</p><p><img src=/images/2018_10_19_10_35_41_454x433.jpg alt=/images/2018_10_19_10_35_41_454x433.jpg></p><p>国家:</p><p><img src=/images/2018_10_19_10_35_51_301x314.jpg alt=/images/2018_10_19_10_35_51_301x314.jpg></p><p>keyboard:</p><p><img src=/images/2018_10_19_10_36_05_401x393.jpg alt=/images/2018_10_19_10_36_05_401x393.jpg></p><p>配置下主机名:</p><p><img src=/images/2018_10_19_10_40_17_719x239.jpg alt=/images/2018_10_19_10_40_17_719x239.jpg></p><p>用户名/密码配置test/xxxker</p><p>之后就是一直安装，直到结束。</p><p>进入系统后，配置IP地址，需要手工检测网络是否联通:</p><p><img src=/images/2018_10_19_11_06_46_423x302.jpg alt=/images/2018_10_19_11_06_46_423x302.jpg></p><p>Enable
root用户，且设置opensshd的root用户登录权限，而后重新启动系统供下步配置使用。</p><h3 id=配置系统>配置系统</h3><p>关闭swap分区，</p><pre><code># swapoff -a
# vim /etc/fatab
注释掉swap分区。
# lvremove /dev/mapper/armk8s--vg-swap_1
# lvextend -l +100%FREE /dev/mapper/armk8s--vg-root
# resize2fs /dev/mapper/armk8s--vg-root
</code></pre><p>从互联网上下载整个 arm repo的mirror包，大约60G，
而后修改<code>/etc/apt/sources.list</code>如下:</p><pre><code>deb http://192.192.189.128:8000/ xenial main restricted universe multiverse
deb http://192.192.189.128:8000/ xenial-security main restricted universe multiverse
deb http://192.192.189.128:8000/ xenial-updates main restricted universe multiverse
deb http://192.192.189.128:8000/ xenial-proposed main restricted universe multiverse
deb http://192.192.189.128:8000/ xenial-backports main restricted universe multiverse
</code></pre><p>现在运行<code>apt-get update</code>可以安装包, 例如<code>apt-get install nethogs</code>.</p><p>安装docker:</p><pre><code># apt-get install docker.io
# docker version
</code></pre><p><img src=/images/2018_10_19_11_34_09_488x421.jpg alt=/images/2018_10_19_11_34_09_488x421.jpg></p><p>离线下载deb包，传送到服务器，而后运行:</p><p><img src=/images/2018_10_19_12_25_37_995x185.jpg alt=/images/2018_10_19_12_25_37_995x185.jpg></p><h3 id=镜像准备>镜像准备</h3><p>下载所需镜像并传送到机器:</p><pre><code>docker pull k8s.gcr.io/kube-apiserver-arm64:v1.11.2
docker pull k8s.gcr.io/kube-controller-manager-arm64:v1.11.2
docker pull k8s.gcr.io/kube-scheduler-arm64:v1.11.2
docker pull k8s.gcr.io/kube-proxy-arm64:v1.11.2
docker pull k8s.gcr.io/etcd-arm64:3.2.18
docker pull k8s.gcr.io/pause:3.1
docker pull k8s.gcr.io/coredns:1.1.3
docker pull weaveworks/weave-npc:2.4.1
docker pull weaveworks/weave-kube:2.4.1
docker pull k8s.gcr.io/kubernetes-dashboard-arm:v1.10.0
</code></pre><p>构建过程:</p><pre><code># kubeadm init --apiserver-advertise-address 192.192.190.95 --kubernetes-version=v1.11.2
# mkdir -p ~/.kube
# cp -i /etc/kubernetes/admin.conf ~/.kube/config
# chown $(id -u):$(id -g) /root/.kube/config
# export kubever=$(kubectl version | base64 | tr -d '\n')
# kubectl apply -f &quot;https://cloud.weave.works/k8s/net?k8s-version=$kubever&quot;
# wget https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard-arm.yaml
# kubectl apply -f kubernetes-dashboard-arm.yaml
# kubectl create clusterrolebinding cluster-admin-fordashboard --clusterrole=cluster-admin --user=system:serviceaccount:kube-system:kubernetes-dashboard
</code></pre><p>Monitoring:</p><pre><code># git clone https://github.com/kubernetes/heapster.git
# cd heapster/deploy/kube-config/influxdb
# cp heapster.yaml heapster_arm.yaml
# cp influxdb.yaml influxdb_arm.yaml
# cp grafana.yaml grafana_arm.yaml
Change from amd64 to arm64
# kubectl create -f *_arm.yaml
</code></pre><p>This monitoring will not working OK. why?</p></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>