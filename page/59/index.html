<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2019/06/28/arm64kubesprayofflinetips/>arm64KubesprayOfflineTips</a></h1><span class=post-date>Jun 28, 2019<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=folder-structure>Folder structure</h3><p>Compare the downloaded source code to our offlined edition, make some changes.</p><pre><code>cluster.yml should added kube-deploy related items.   
ansible.cfg should be modified.
Added role/kube-deploy folder. 
scale.yml/upgrade-cluster.yml should be modified. 
Added deploy.key for easy deployment. 
roles/kubernetes-apps/ansible/defaults/main.yml, modified dashboard_skip_login condition
roles/kubernetes-apps/ansible/templates/dashboard.yml.j2: NodePort modification
roles/kubespray-defaults/defaults/main.yaml: enable_nodelocaldns:false(TBD)
roles/download/defaults/main.yml: download position, for example hyperkube/kubeadm/cni/calicoctl etc. 
/roles/kubernetes/master/templates/kubeadm-config.v1alpha3.yaml.j2: controllerManager listening port to 0.0.0.0
roles/kubernetes/master/tasks/kubeadm-upgrade.yml: upgrade items to --force
</code></pre><h3 id=todo-bootstrapsh>(Todo) bootstrap.sh</h3><p>Change the installation of ansible from apt-get to pip-cache</p><pre><code>#!/bin/sh
## 
OS_ID=`cat /etc/os-release | grep VERSION_CODENAME | awk -F '=' {'print $2'}`
echo $OS_ID
# xenial use 1604, bionic use 1804
if [ &quot;$OS_ID&quot; = &quot;xenial&quot; ]; then
	sudo tar xJvf ./roles/kube-deploy/files/1604debs.tar.xz -C /usr/local/
else
	sudo tar xJvf ./roles/kube-deploy/files/1804debs.tar.xz -C /usr/local/
	sudo tar xJvf ./roles/kube-deploy/files/pip_ansible.tar.xz -C /usr/local/
fi
sudo echo &quot;deb [trusted=yes] file:///usr/local/static ./&quot;&gt;/etc/apt/sources.list
sudo apt-get update -y
# Install pip so we could use pip for installing ansible
sudo DEBIAN_FRONTEND=noninteractive apt-get install -y python-pip
# Install ansible via ansible(version 2.8.1)
sudo pip install --no-index --find-links /usr/local/pip_ansible ansible
sudo DEBIAN_FRONTEND=noninteractive apt-get install -y python-netaddr
</code></pre><h3 id=kube-deploy-role>kube-deploy role</h3><p>Added the offline role, and replace the files.</p><p>Replace:</p><pre><code>nginx-autoindex.tar.xz 
kubeadm(arm version)
hyperkube(arm version)
cni-plugins-arm64-v0.6.0.tgz(arm version)
calicoctl(arm version)

</code></pre><h3 id=nginx-autoindex>nginx-autoindex</h3><p>Find the Dockerfile, and build the arm64 based docker images via following commands:</p><pre><code># mkdir -p ~/code/autoindex
# vim Dockerfile
FROM nginx
MAINTAINER Jason Kingsbury

RUN sed -i 'N; s/root   \/usr\/share\/nginx\/html;\n        index  index.html index.htm;/root   \/usr\/share\/nginx\/html;\n        autoindex on;/' /etc/nginx/conf.d/default.conf
# sudo docker build -t jrelva/nginx-autoindex:latest .
# sudo docker  --name docker-nginx -p 7888:80 -d --restart=always -v `pwd`:/usr/share/nginx/html jrelva/nginx-autoindex
</code></pre><p>Save and xz the docker images:</p><pre><code># sudo docker save jrelva/nginx-autoindex:latest&gt;autoindex.tar; sudo xz autoindex.tar
</code></pre><p>Transfer the autoindex.tar.xz to folder.</p><pre><code>➜  files ls -l -h | grep autoindex
-rwxr-xr-x  1 dash dash  26M 5月   7 16:40 autoindex.tar.xz
➜  files pwd
/home/dash/Code/kubsprayarm64/roles/kube-deploy/files
➜  files ls -l -h | grep autoindex
-rwxr-xr-x  1 dash dash  23M 6月  28 10:59 autoindex.tar.xz
</code></pre><h3 id=secureregistryserver>secureregistryserver</h3><p>Change the docker-compose file, also pull the arm based docker images:</p><pre><code># docker pull registry:2
# docker pull nginx:latest
# docker save registry:2&gt;regsitry.tar; xz registry.tar
# docker save nginx:latest&gt;nginx19.tar; xz nginx19.tar

</code></pre><h3 id=verification>Verification</h3><p>Create a new virtual machine(18.04.2):</p><pre><code>$ qemu-img create -f qcow2 pure1804.qcow2 200G
```'
Install the system:    

![/images/2019_06_28_12_10_54_469x237.jpg](/images/2019_06_28_12_10_54_469x237.jpg)


### harbor offline
With the harbor-offline-installer-1.7.0-arm64.tgz we could quickly setup the offline harbor environment:    

</code></pre><h1 id=ls>ls</h1><p>common docker-compose.clair.yml docker-compose.yml harbor.cfg LICENSE prepare<br>docker-compose.chartmuseum.yml docker-compose.notary.yml harbor.1.7.0-arm64.tar.gz install.sh open_source_license</p><h1 id=vim-harborcfg>vim harbor.cfg</h1><h1 id=installsh---with-chartmuseum>./install.sh &ndash;with-chartmuseum</h1><h1 id=docker-ps>docker ps</h1><p>&mldr;..</p><pre><code>
Login:    

![/images/2019_06_28_12_19_39_475x380.jpg](/images/2019_06_28_12_19_39_475x380.jpg)

Create user kubespray:    

![/images/2019_06_28_12_19_59_447x368.jpg](/images/2019_06_28_12_19_59_447x368.jpg)

Fill in user info:    

![/images/2019_06_28_12_20_28_555x469.jpg](/images/2019_06_28_12_20_28_555x469.jpg)

Create project:    

![/images/2019_06_28_12_21_45_549x348.jpg](/images/2019_06_28_12_21_45_549x348.jpg)

Projects:    

![/images/2019_06_28_12_22_02_667x296.jpg](/images/2019_06_28_12_22_02_667x296.jpg)

Add kubespray to kubesprayns as administrator:    

![/images/2019_06_28_12_22_42_718x295.jpg](/images/2019_06_28_12_22_42_718x295.jpg)

Now you could login with kubespray user:    

![/images/2019_06_28_12_23_52_936x419.jpg](/images/2019_06_28_12_23_52_936x419.jpg)

Now in docker-compose folder we just `docker-compose down` all of the service and backup our environment:    

</code></pre><h1 id=docker-compose-down>docker-compose down</h1><p>Stopping nginx &mldr; done
Stopping harbor-jobservice &mldr; done
Stopping harbor-portal &mldr; done
Stopping harbor-core &mldr; done
Stopping redis &mldr; done
Stopping harbor-adminserver &mldr; done
Stopping harbor-db &mldr; done
Stopping registry &mldr; done
Stopping registryctl &mldr; done
Stopping harbor-log &mldr;</p><h1 id=docker-save--o-harbortar-goharborchartmuseum-photonv071-170-arm64-goharborredis-photon170-arm64-goharborclair-photonv207-170-arm64-goharbornotary-server-photonv061-170-arm64-goharbornotary-signer-photonv061-170-arm64-goharborharbor-registryctl170-arm64-goharborregistry-photonv262-170-arm64-goharbornginx-photon170-arm64-goharborharbor-log170-arm64-goharborharbor-jobservice170-arm64-goharborharbor-core170-arm64-goharborharbor-portal170-arm64-goharborharbor-adminserver170-arm64-goharborharbor-db170-arm64>docker save -o harbor.tar goharbor/chartmuseum-photon:v0.7.1-1.7.0-arm64 goharbor/redis-photon:1.7.0-arm64 goharbor/clair-photon:v2.0.7-1.7.0-arm64 goharbor/notary-server-photon:v0.6.1-1.7.0-arm64 goharbor/notary-signer-photon:v0.6.1-1.7.0-arm64 goharbor/harbor-registryctl:1.7.0-arm64 goharbor/registry-photon:v2.6.2-1.7.0-arm64 goharbor/nginx-photon:1.7.0-arm64 goharbor/harbor-log:1.7.0-arm64 goharbor/harbor-jobservice:1.7.0-arm64 goharbor/harbor-core:1.7.0-arm64 goharbor/harbor-portal:1.7.0-arm64 goharbor/harbor-adminserver:1.7.0-arm64 goharbor/harbor-db:1.7.0-arm64</h1><h1 id=xz-harbortar>xz harbor.tar</h1><pre><code></code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2019/06/26/raspberrypiarm64/>RaspberryPIArm64</a></h1><span class=post-date>Jun 26, 2019<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=aim>AIM</h3><p>Replace the armhf(raspbain) with arm64 system.<br>Refers to:</p><p><a href=/home/dash/Code/blogsource-master/src/content/post/2019-06-26-RaspberryPIArm64.md>/home/dash/Code/blogsource-master/src/content/post/2019-06-26-RaspberryPIArm64.md</a></p><h3 id=installation>Installation</h3><p>Unxz the images and write to the tf card:</p><pre><code># unxz ubuntu-18.04.2-preinstalled-server-arm64+raspi3.img.xz
# sudo dd if=./ubuntu-18.04.2-preinstalled-server-arm64+raspi3.img of=/dev/sdd bs=1M &amp;&amp; sudo sync
</code></pre><h3 id=configuration>Configuration</h3><p>Configure the repository :</p><pre><code># vim /etc/apt/sources.list
deb https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic main main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic-updates main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic-updates main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic-backports main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic-backports main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic-security main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu-ports/ bionic-security main restricted universe multiverse
# sudo apt-get update -y
# sudo apt-get upgrade -y
# sudo hostnamectl set-hostname arm64
# sudo apt-get install -y build-essential
</code></pre><p>Install docker-ce for arm64:</p><pre><code>#  offline packages. 
# apt-get install -y docker-ce
# docker version
# cd /var/lib
# cp -r docker /media/sda/
# mv docker docker.back
# ln -s /media/sda/docker .
# ls -l -h | grep docker
lrwxrwxrwx  1 root      root        17 Jun 26 04:16 docker -&gt; /media/sda/docker
drwxr-xr-x  2 root      root      4.0K Jun 26 04:13 docker-engine
drwx--x--x 14 root      root      4.0K Jun 26 04:13 docker.back
# systemctl start docker
</code></pre><p>Building harbor:</p><pre><code># apt-get install -y docker-compose

</code></pre><p>dns issue, install stubby:</p><pre><code># apt-get install -y stubby
# vim /etc/resolv.conf
nameserver 127.0.0.1
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2019/06/25/tipsonarmvirtmanager/>TipsOnARMVirtManager</a></h1><span class=post-date>Jun 25, 2019<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Install following packages:</p><pre><code># apt-get install -y virt-manager 
# sudo apt-get install -y qemu-efi-aarch64 qemu-efi-arm ovmf
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2019/06/25/tipsonraid10/>TipsOnRaid10</a></h1><span class=post-date>Jun 25, 2019<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Find how many disks are available in system:</p><pre><code># fdisk -l
</code></pre><p>Examine the detailed info:</p><pre><code># lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT
NAME     SIZE FSTYPE  TYPE MOUNTPOINT
loop0  876.9M iso9660 loop /media/cdrom
sda    557.9G         disk 
├─sda1   512M vfat    part /boot/efi
└─sda2 557.4G ext4    part /
sdb      3.7T         disk 
sdc      3.7T         disk 
sdd      3.7T         disk 
sde      3.7T         disk 
sdf      3.7T         disk 
sdg      3.7T         disk 
sdh      3.7T         disk 
sdi      3.7T         disk 
sdj      3.7T         disk 
sdk      3.7T         disk 
sdl      3.7T         disk 
sdm      3.7T         disk
</code></pre><p>Create the raid10 using following command:</p><pre><code>#  mdadm --create --verbose /dev/md0 --level=10 --raid-devices=12 /dev/sdb /dev/sdc /dev/sdd /dev/sde /dev/sdf /dev/sdg /dev/sdh /dev/sdi /dev/sdj /dev/sdk /dev/sdl /dev/sdm
</code></pre><p>View the status, now you could use it:</p><pre><code>#  cat /proc/mdstat
</code></pre><p>Make filesystem for using:</p><pre><code># mkfs.ext4 -F /dev/md0
</code></pre><p>Create mount point and mount the md0:</p><pre><code># mkdir -p /media/md0
# mount /dev/md0 /media/md0
# df -h
</code></pre><p>Add md items to mdadm configuration file, so next time bootup kernel will recognize it, also add fstab items:</p><pre><code>#  mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf
#  cat /etc/mdadm/mdadm.conf 
#  update-initramfs -u
#  echo '/dev/md0 /mnt/md0 ext4 defaults,nofail,discard 0 0' | sudo tee -a /etc/fstab
#  cat /etc/fstab 
</code></pre><p>Now view the lsblk output will show like following:</p><pre><code>lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT
NAME     SIZE FSTYPE            TYPE   MOUNTPOINT
loop0  876.9M iso9660           loop   /media/cdrom
sda    557.9G                   disk   
├─sda1   512M vfat              part   /boot/efi
└─sda2 557.4G ext4              part   /
sdb      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdc      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdd      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sde      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdf      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdg      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdh      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdi      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdj      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdk      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdl      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
sdm      3.7T linux_raid_member disk   
└─md0   21.9T ext4              raid10 /media/md0
</code></pre><h3 id=remove-md>remove md</h3><p>via:</p><pre><code>sudo mdadm --stop /dev/md0
sudo mdadm --detail /dev/md0
sudo mdadm --zero-superblock /dev/sdx
sudo mv /etc/mdadm/mdadm.conf /etc/mdadm/mdadm.conf.bak
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2019/06/24/workingtipsonarmkubespray/>WorkingTipsOnArmKubespray</a></h1><span class=post-date>Jun 24, 2019<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=emulation>Emulation</h3><p>Install uml-utilites for arm emulator networking:</p><pre><code># sudo apt-get install -y uml-utilities
# sudo tunctl -u  dash -t tap0
# sudo ifconfig tap0 192.168.101.1 up
# echo 1 &gt; /proc/sys/net/ipv4/ip_forward
# iptables -t nat -A POSTROUTING -o enp0s20f0u12u1 -j MASQUERADE
# iptables -I FORWARD 1 -i tap0 -j ACCEPT
# iptables -I FORWARD 1 -o tap0 -m state --state RELATED,ESTABLISHED -j ACCEPT
</code></pre><p>Now your tap0 will be ready for working.</p><p>Install qemu for aarch64:</p><pre><code># apt-get install qemu-system-arm
# which qemu-system-aarch64
/usr/bin/qemu-system-aarch64
</code></pre><p>Using emulator via:</p><pre><code>qemu-system-aarch64 -m 6024 -cpu cortex-a57  -M virt -nographic -pflash flash0.img -pflash flash1.img -drive if=none,file=bionic-server-cloudimg-arm64.img,id=hd0 -device virtio-blk-device,drive=hd0 -drive file=user-data.img,format=raw -net nic -net tap,ifname=tap0,script=no #-device virtio-net-device,netdev=net0,mac=52:54:00:12:34:56
</code></pre><p>Too slow on x86. So I switches to arm based server.</p><h3 id=workingonarmserver>WorkingOnARMServer</h3><p>Mount iso and use it as the repository server:</p><pre><code>#  mount -t iso9660 -o loop ubuntu-18.04.2-server-arm64.iso /mnt
# apt-cdrom -d=/mnt add
#  cat /etc/apt/sources.list
deb cdrom:[Ubuntu-Server 18.04.2 LTS _Bionic Beaver_ - Release arm64 (20190210)]/ bionic main r
estricted
# apt-get update -y
# cp ubuntu-18.04.2-server-arm64.iso ubuntu-18.04.2-server-arm64-1.iso
# mount -t iso9660 -o loop ./ubuntu-18.04.2-server-arm64-1.iso /media/cdrom
</code></pre><p>Install some packages for qemu:</p><pre><code># apt-get install -y qemu-kvm build-essential 
</code></pre><p>When offline, we use the offline repository:</p><pre><code># cd /root/armdebs
# dpkg-scanpackages . /dev/null | gzip -9c &gt; Packages.gz
# vim /etc/apt/sources.list
deb [trusted=yes] file:///home/test/armdebs ./
# apt-get update -y
# apt-get install -y uml-utilities
</code></pre><p>From now on we could use qemu-kvm for accessing our vm.</p><p>Run emulated vms and install kubernetes, successful.</p><h3 id=migration>Migration</h3><p>Notice, you should run following(pip download) on arm based machine!!!<br>On phsical machine, do following steps:</p><pre><code># apt-get install -y python-pip
# mkdir piparmarm
# cd piparmarm/
# pip download ansible
# pip download httplib2
</code></pre><p>Transfer the <code>piparmarm</code> folder to your machine, install it via:</p><pre><code>root@arm01:~/piparmarm# pip install --no-index --find-links /home/test/piparmarm/ ansible httplib2
root@arm01:~/piparmarm# which ansible
/usr/local/bin/ansible
root@arm01:~/piparmarm# ansible --version
ansible 2.8.1
  config file = None
  configured module search path = [u'/home/test/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/local/lib/python2.7/dist-packages/ansible
  executable location = /usr/local/bin/ansible
  python version = 2.7.15rc1 (default, Nov 12 2018, 14:31:15) [GCC 7.3.0]
</code></pre><p>Install docker-ce(manually):</p><pre><code># apt-get install -y docker-ce python-netaddr
# docker load&lt;allimages.tar
</code></pre><p>Configure the hosts.ini, then run playbook:</p><pre><code># ansible-playbook -i inventory/sample/hosts.ini cluster.yml
</code></pre><h3 id=helm-building>helm building</h3><p>helm docker image doesn&rsquo;t support arm64, thus we do following steps for rebuilding our own image:</p><pre><code># wget https://storage.googleapis.com/kubernetes-helm/helm-${HELM_LATEST_VERSION}-linux-arm64.tar.gz
# tar xzvf helm-xxxxx-linux-arm64.tar.gz
# mv linux-arm64/helm ~/dockerbuild
# cd ~/dockerbuild
# vim Dockerfile
</code></pre><p>The Dockerfile we changes to following:</p><pre><code>FROM alpine

LABEL maintainer=&quot;Lachlan Evenson &lt;lachlan.evenson@gmail.com&gt;&quot;

ARG VCS_REF
ARG BUILD_DATE

# Metadata
LABEL org.label-schema.vcs-ref=$VCS_REF \
      org.label-schema.vcs-url=&quot;https://github.com/lachie83/k8s-helm&quot; \
      org.label-schema.build-date=$BUILD_DATE \
      org.label-schema.docker.dockerfile=&quot;/Dockerfile&quot;

ENV HELM_LATEST_VERSION=&quot;v2.13.1&quot;

COPY . /usr/local/bin

ENTRYPOINT [&quot;helm&quot;]
CMD [&quot;help&quot;]
</code></pre><p>Build the image with following commands:</p><pre><code># docker image build -t lachlanevenson/k8s-helm:v2.13.1-arm64 .
# docker save -o helmarm.tar lachlanevenson/k8s-helm:v2.13.1-arm64
</code></pre><p>Using the arm64 based image we could setup helm on kubespray.</p><h3 id=harbor-on-arm64>harbor on arm64</h3><p>Install docker-compose via:</p><pre><code># pip download docker-compose
# Install docker-compose in offline environment. 
</code></pre><p>Clone the repository and extract it to:</p><pre><code># pwd
/home/dash/Downloads/harbor-arm64/harbor-arm64-develop
# cd make
# ls
checkenv.sh                     docker-compose.clair.yml   harbor.cfg  prepare
common                          docker-compose.notary.tpl  install.sh  pushimage.sh
docker-compose.chartmuseum.tpl  docker-compose.notary.yml  kubernetes
docker-compose.chartmuseum.yml  docker-compose.tpl         migrations
docker-compose.clair.tpl        docker-compose.yml         photon
</code></pre><p>The docker-compose file exists under folder.</p><p>changed to using repository&rsquo;s docker-compose.<code> apt-get install -y docker-compose</code>.</p></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/58/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/58/>58</a></li><li class="page-item active"><a class=page-link href=/page/59/>59</a></li><li class=page-item><a class=page-link href=/page/60/>60</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/240/>240</a></li><li class=page-item><a href=/page/60/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/240/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>