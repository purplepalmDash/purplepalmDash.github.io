<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/06/11/tipsonjenkinsx/>TipsOnJenkinsX</a></h1><span class=post-date>Jun 11, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=install>Install</h3><p>Install under archlinux:</p><pre><code># curl -L https://github.com/jenkins-x/jx/releases/download/v1.2.120/jx-linux-amd64.tar.gz | tar xzv 
# sudo mv jx /usr/local/bin
</code></pre><p>upgrading minikube:</p><pre><code># docker-machine-driver-kvm2
</code></pre><p>Now create the cluster via:</p><pre><code># jx create cluster minikube
? cpu (cores) 3
? Select driver: kvm2
WARNING: We cannot yet automate the installation of KVM with KVM2 driver - can you install this manually please?
Please see: https://www.linux-kvm.org/page/Downloads and https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#kvm2-driver
Creating Minikube cluster...

</code></pre><h3 id=chartmusuem>chartmusuem</h3><p>Install local executable file:</p><pre><code># curl -LO https://s3.amazonaws.com/chartmuseum/release/latest/bin/linux/amd64/chartmuseum
# chmod +x ./chartmuseum
# mv ./chartmuseum /usr/local/bin
</code></pre><p>Initialize with the local filesystem storage:</p><pre><code># sudo mkdir chartstorage
# sudo chartmuseum --debug --port=8988 --storage=&quot;local&quot; --storage-local-rootdir=&quot;./chartstorage&quot;
</code></pre><p>Now visit your <code>http://localhost:8988</code> you could reach the chartmusuem.</p><p>Using chartmusuem:</p><pre><code># helm repo add chartmuseum http://localhost:8988
# helm update
</code></pre><p>Upload chart:</p><pre><code># git clone https://github.com/stakater/chart-mysql.git
# cd chart-mysql
# cd mysql
# helm lint
# helm package .
# curl -L --data-binary &quot;@mysql-1.0.1.tgz&quot; http://localhost:8988/api/charts
</code></pre><p>Now you could see the chart has been uploaded to your own chartmusuem.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/06/04/oncustomizecentoslivecd/>OnCustomizeCentOSLiveCD</a></h1><span class=post-date>Jun 4, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=preparation>Preparation</h3><p>A. Create local repository for centos installation:</p><p>Install <code>createrepo_c</code>on archlinux:</p><pre><code># yaout createrepo_c
</code></pre><p>Create the repo for local installation:</p><pre><code># sudo mount -t iso9660 -o loop CentOS-7-x86_64-Everything-1804.iso /mnt2
# cd /mnt2
# find . | grep rpm$ | xargs -I % cp % /var/download/centos1804rpms
# cd /var/download/centos1804rpms
# createrepo_c .
</code></pre><p>Use this repo:</p><pre><code># mkdir /etc/yum.repos.d/back &amp;&amp; mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/back/
# vim /etc/yum.repos.d/base.repo 
[base]
name=base
baseurl=http://192.168.122.1/centos1804rpms
enabled=1
gpgcheck=0
</code></pre><p>B. Prepare kickstart repository</p><pre><code># git clone https://github.com/CentOS/sig-core-livemedia.git
# cd sig-core-livemedia
# cd kickstarts
# wget https://gist.githubusercontent.com/lunatilia/8a195ccb0b415cbbd94f/raw/e8ede17f331dc8fe43012e7e4f8123a02e6bedc8/centos-7-livedvd-jp.cfg
</code></pre><p>C. Edit the cfg file, the modified file is listed in following position:</p><h3 id=make-system>Make system</h3><p>In chroot terminal, do following:</p><pre><code>#  yum remove -y libreoffice-gtk3-5.3.6.1-10.el7.x86_64 libreoffice-draw-5.3.6.1-10.el7.x86_64 libreoffice-ure-5.3.6.1-10.el7.x86_64 libreoffice-pyuno-5.3.6.1-10.el7.x86_64 libreoffice-xsltfilter-5.3.6.1-10.el7.x86_64 libreoffice-gtk2-5.3.6.1-10.el7.x86_64 libreoffice-graphicfilter-5.3.6.1-10.el7.x86_64 libreoffice-math-5.3.6.1-10.el7.x86_64 libreoffice-filters-5.3.6.1-10.el7.x86_64 libreoffice-data-5.3.6.1-10.el7.noarch libreoffice-core-5.3.6.1-10.el7.x86_64 libreoffice-pdfimport-5.3.6.1-10.el7.x86_64 libreoffice-calc-5.3.6.1-10.el7.x86_64 libreofficekit-5.3.6.1-10.el7.x86_64 libreoffice-ure-common-5.3.6.1-10.el7.noarch libreoffice-langpack-en-5.3.6.1-10.el7.x86_64 libreoffice-impress-5.3.6.1-10.el7.x86_64 libreoffice-opensymbol-fonts-5.3.6.1-10.el7.noarch libreoffice-x11-5.3.6.1-10.el7.x86_64 libreoffice-writer-5.3.6.1-10.el7.x86_64
# yum remove -y cheese
# cd /usr/local/
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/compose.tar.gz .
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/kismaticpkgs.tar.gz .
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/images.tar.gz . 
# cd /var/lib
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/portus.tar.gz .
# tar xzvf portus.tar.gz 
# rm -f portus.tar.gz 
# cd /usr/local/
# tar xzvf compose.tar.gz 
# tar xzvf images.tar.gz 
# tar xzvf kismaticpkgs.tar.gz 
# rm -f *.tar.gz
# cd /root/
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/pipcache.tar.gz .
# tar xzvf pipcache.tar.gz 
# pip install --no-index --find-links /root/pipcache docker-compose
# rm -f pipcache.tar.gz 
# rm -rf pipcache/
# cd /bin/
# scp root@192.192.189.128:/media/sdb/docker/loaddocker.sh .
# chmod 777 loaddocker.sh 
# cat loaddocker.sh 
    if [[ $(sudo docker images | grep registry) ]]; then
        echo &quot;there are files&quot;
    else
        docker load&lt;/usr/local/images/nginx.tar.bz2
        docker load&lt;/usr/local/images/1.tar
        docker load&lt;/usr/local/images/2.tar
        docker load&lt;/usr/local/images/3.tar
        docker load&lt;/usr/local/images/4.tar
        docker run --name docker-nginx -p 8888:80 -d -v /usr/local/kismaticpkgs:/usr/share/nginx/html jrelva/nginx-autoindex
        sed -i s/10.168.100.145/`hostname -I|awk '{print $1}'`/g /usr/local/compose/docker-compose.yml
    fi

# cd /etc/systemd/system/
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/mynginx.service .
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/docker-infra.service .
# systemctl enable sshd.service
# cd /root
# scp root@192.192.189.128:/media/sdd/kvm_storage/ansible_kismatic/ansible_kismatic1110/kismatic.tar.gz .
# yum install -y ntp
# vim /etc/ntp.conf
# systemctl enable ntpd
# systemctl disable chronyd
# systemctl disable firewalld
# vi /etc/selinux/config
     disable the selinux configuration
</code></pre><p>Exit the chroot, the program will continue to build the iso.</p><h3 id=boot-up-the-system>boot-up the system</h3><p>After bootup the system, install the os via clicking the live install icon on the desktop.</p><p>In newly installed system, do following things:</p><pre><code># systemctl enable docker
# systemctl start docker
# /bin/loaddocker.sh
# systemctl enable mynginx.service
# systemctl enable docker-infra.service
# reboot
</code></pre><p>Now you could check your installation.</p><p>Sometimes the boot will fail, I don&rsquo;t know why, maybe because of the dracut issue?</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/05/30/synckismaticimages/>SyncKismaticImages</a></h1><span class=post-date>May 30, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>搭建完Portus镜像后，如何重新初始化，并获得更新的kismatic镜像？这里记录了步骤。</p><h3 id=清空已有镜像>清空已有镜像</h3><p>运行以下命令，可以得到一个全新的portus镜像仓库:</p><pre><code># systemctl stop docker-infra.service
# cd /usr/local/compose
# docker-compose down
Stopping compose_nginx_1      ... done
Stopping compose_background_1 ... done
Stopping compose_registry_1   ... done
Stopping compose_portus_1     ... done
Stopping compose_db_1         ... done
Removing compose_nginx_1      ... done
Removing compose_background_1 ... done
Removing compose_registry_1   ... done
Removing compose_portus_1     ... done
Removing compose_db_1         ... done
Removing network compose_default
# cd /var/lib
# mv portus portus.back
# mkdir portus
# docker volume rm compose_static
# systemctl start docker-infra.service
</code></pre><h3 id=配置新仓库>配置新仓库</h3><p>在打开浏览器访问portus仓库前，手动添加条目至/etc/hosts文件，IP地址需手动更改 :</p><pre><code>$ sudo echo &quot;192.192.189.53	portus.xxxx.com&quot;&gt;&gt;/etc/hosts
</code></pre><p>打开浏览器访问 <code>https://portus.xxxx.com</code>:</p><p><img src=/images/2018_05_19_17_36_55_626x496.jpg alt=/images/2018_05_19_17_36_55_626x496.jpg></p><p>在页面弹出的提示中，填入以下参考值:</p><p><img src=/images/2018_05_19_17_37_51_488x262.jpg alt=/images/2018_05_19_17_37_51_488x262.jpg></p><p>Team->Create new team, 创建一个名为 kismatic 的团队:</p><p><img src=/images/2018_05_19_17_40_16_397x279.jpg alt=/images/2018_05_19_17_40_16_397x279.jpg></p><p>Admin->User->Create new user, 创建一个名为kismatic的用户:</p><p><img src=/images/2018_05_19_17_41_59_434x313.jpg alt=/images/2018_05_19_17_41_59_434x313.jpg></p><p>创建好的用户如下所示:</p><p><img src=/images/2018_05_19_17_42_41_1023x262.jpg alt=/images/2018_05_19_17_42_41_1023x262.jpg></p><p>Team->members->Add members,
添加kismatic用户到kismatic组里，定义其角色为Contributer， 即可push/pull镜像:</p><p><img src=/images/2018_05_19_17_43_32_640x169.jpg alt=/images/2018_05_19_17_43_32_640x169.jpg></p><p>创建一个新的命名空间，并绑定到kismatic组:</p><p><img src=/images/2018_05_19_17_44_28_440x297.jpg alt=/images/2018_05_19_17_44_28_440x297.jpg></p><p>执行的步骤可以在portus的logs里看到:</p><p><img src=/images/2018_05_19_17_45_14_584x314.jpg alt=/images/2018_05_19_17_45_14_584x314.jpg></p><h3 id=kismatic-v110同步镜像>kismatic v1.10同步镜像</h3><p>到<a href=https://github.com/apprenda/kismatic/releases>https://github.com/apprenda/kismatic/releases</a>下载kismatic对应的版本.</p><p>解压后的情况:</p><pre><code># pwd
/home/xxxx/code/kismatic1110
# ls
ansible  helm  kismatic  kubectl  provision
</code></pre><p>创建plan文件:</p><pre><code> ./kismatic install plan
Plan your Kubernetes cluster:
=&gt; Number of etcd nodes [3]: 1
=&gt; Number of master nodes [2]: 1
=&gt; Number of worker nodes [3]: 1
=&gt; Number of ingress nodes (optional, set to 0 if not required) [2]: 0
=&gt; Number of storage nodes (optional, set to 0 if not required) [0]: 0
=&gt; Number of existing files or directories to be copied [0]: 0
</code></pre><p>由此则产生了<code>kismatic-cluster.yaml</code>文件,
编辑对应的IP配置，可以参考已有的配置， 其中仓库的配置部分如下:</p><pre><code># vim kismatic-cluster.yaml
docker_registry:

  # IP or hostname and port for your registry.
  server: &quot;portus.xxxx.com:5000/kismatic110&quot;

  # Absolute path to the certificate authority that should be trusted when
  # connecting to your registry.
  CA: &quot;/home/xxxxx/portus.xxxx.com.crt&quot;

  # Leave blank for unauthenticated access.
  username: &quot;kismatic&quot;

  # Leave blank for unauthenticated access.
  password: &quot;xxxxxxxx&quot;
</code></pre><p>同步仓库：</p><pre><code># ./kismatic seed-registry --verbose
</code></pre><p>同步完毕以后，取回镜像包：</p><pre><code># systemctl stop docker-infra.service
# cd /var/lib/
# tar czvf portus.tar.gz portus/
</code></pre><h3 id=rpm包取回>rpm包取回</h3><p>设置节点机的<code>/etc/yum.conf</code>下为保存rpm包，一次在线安装后，即可获得所有的rpm包。createrepo
后直接取回。</p><h3 id=重组安装源>重组安装源</h3><p>一次详细的重组步骤如下:</p><pre><code># 复制旧版本框架
cp -r ansible ansible_kismatic1110
cd ansible_kismatic1110
# 更新docker镜像源
rm -f portus.tar.gz
scp root@10.168.100.150:/var/lib/portus.tar.gz .
rm -f kismaticpkgs.tar.gz 
# 更新rpm源
scp -r root@10.168.100.150:/usr/local/kismaticpkgs.tar.gz .
# 更新kismatic部署框架
tar xzvf kismatic.tar.gz
cd kismatic/cluster00
rm -rf ./*
sudo cp -ar /media/sda5/Code/kismatic1110/* .
sudo rm -rf generated
sudo rm -rf ./runs/apply/*
sudo rm -rf ./runs/preflight/*
sudo rm -rf ./runs/smoketest/*
rm -f kismatic.tar.gz
sudo tar czvf kismatic.tar.gz kismatic
sudo rm -rf kismatic
</code></pre><p>重组后的大小:</p><pre><code># du -hs ansible_kismatic1110 
1.2G	ansible_kismatic1110
</code></pre><p>现在就可以用原有方法进行系统的部署了。</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/05/24/workingtipsonplaywithdockerubuntu1804/>WorkingTipsOnPlayWithDockerUbuntu1804</a></h1><span class=post-date>May 24, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=basic-environment>Basic Environment</h3><p>Ubuntu 18.04, minimum installation.</p><pre><code># vim /etc/netplan/01-netcfg.yaml 
	# This file describes the network interfaces available on your system
	# For more information, see netplan(5).
	network:
	 version: 2
	 renderer: networkd
	 ethernets:
	   eth0:
	     dhcp4: no
	     dhcp6: no
	     addresses: [192.192.189.114/24]
	     gateway4: 192.192.189.1
	     nameservers:
	       addresses: [223.5.5.5,180.76.76.76]
# sudo netplan --debug apply
# apt-get update &amp;&amp; apt-get install -y docker.io docker-compose
</code></pre><p>Disable systemd-resolved:</p><pre><code># systemctl disable systemd-resolved.service
# systemctl stop systemd-resolved.service
# echo nameserver 192.168.0.15&gt;/etc/resolv.conf
# chattr -e /etc/resolv.conf
# chattr +i /etc/resolv.conf
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/05/22/oncustomizationofubuntuiso/>OnCustomizationOfUbuntuISO</a></h1><span class=post-date>May 22, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=install-cubic>Install cubic</h3><p>Install cubic via:</p><pre><code># apt-add-repository ppa:cubic-wizard/release
# apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 6494C6D6997C215E
# apt update &amp;&amp; apt install cubic
</code></pre><h3 id=custom-packages>Custom Packages</h3><p>Install docker and docker-compose</p><pre><code># apt-get install -y docker.io docker-compose openssh-server
# systemctl enable docker
</code></pre><p>Pre-load docker images:</p><pre><code># vim /bin/loaddocker.sh
if [[ $(sudo docker images | grep registry) ]]; then
    echo &quot;there are files&quot;
else
    docker load&lt;/usr/local/images/1.tar
    docker load&lt;/usr/local/images/2.tar
    docker load&lt;/usr/local/images/3.tar
    docker load&lt;/usr/local/images/4.tar
fi
# chmod 777 /bin/loaddocker.sh
</code></pre><p>Add dockerload service</p><pre><code># vim /etc/systemd/system/dockerload.service 
[Unit]
Description=Docker load
Requires=docker.service
After=docker.service

[Service]
Restart=always
ExecStart=/bin/loaddocker.sh
ExecStop=/usr/bin/echo hello

[Install]
WantedBy=multi-user.target

</code></pre><p>Add this command to systemd:</p><pre><code># vim /etc/systemd/system/docker-infra.service
[Unit]
Description=Docker infra
Requires=docker.service
After=dockerload.service

[Service]
WorkingDirectory=/usr/local/compose/
Type=idle
Restart=always
# Remove old container items
ExecStartPre=/usr/bin/docker-compose -f /usr/local/compose/docker-compose.yml down
# Compose up
ExecStart=/usr/bin/docker-compose -f /usr/local/compose/docker-compose.yml up
# Compose stop
ExecStop=/usr/bin/docker-compose -f /usr/local/compose/docker-compose.yml stop

[Install]
WantedBy=multi-user.target

# systemctl enable docker-infra.service
</code></pre><p>Change the default interface to eth0/eth1, etc.</p><pre><code># vim /etc/default/grub
net.ifnames=0 biosdevname=0
# update-grub
</code></pre><h3 id=remove-unnecessary-packages>Remove unnecessary packages</h3><p>Following:</p><pre><code>Amazon
Libreoffice
Mahjongg
Mines
Shotwell
Sudoku
totem
totem-common
vino
transmission-gtk
transmission-common
remmina
eog

</code></pre><p>Disable ufw:</p><pre><code># ufw disable
</code></pre><p>Remove command:</p><pre><code># apt-get purge   aisleriot eog gnome-mahjongg gnome-mines gnome-sudoku hplip libreoffice-avmedia-backend-gstreamer
  libreoffice-base-core libreoffice-calc libreoffice-common libreoffice-core libreoffice-draw
  libreoffice-gnome libreoffice-gtk3 libreoffice-impress libreoffice-math libreoffice-ogltrans
  libreoffice-pdfimport libreoffice-style-breeze libreoffice-style-galaxy libreoffice-style-tango
  libreoffice-writer  python3-uno remmina remmina-plugin-rdp
  remmina-plugin-secret remmina-plugin-vnc thunderbird thunderbird-gnome-support totem totem-common
  totem-plugins transmission-common transmission-gtk  vino

</code></pre><h3 id=tips-for-centos>tips for centos</h3><pre><code>if [[ $(sudo docker images | grep registry) ]]; then
    echo &quot;there are files&quot;
else
    docker load&lt;/usr/local/images/nginx.tar.bz2
    docker load&lt;/usr/local/images/1.tar
    docker load&lt;/usr/local/images/2.tar
    docker load&lt;/usr/local/images/3.tar
    docker load&lt;/usr/local/images/4.tar
    docker run --name docker-nginx -p 8888:80 -d -v /usr/local/kismaticpkgs:/usr/share/nginx/html jrelva/nginx-autoindex
    sed -i s/10.168.100.145/`hostname -I|awk '{print $1}'`/g /usr/local/compose/docker-compose.yml
fi

</code></pre><p>Add service:</p><pre><code># vim /etc/systemd/system/mynginx.service 
[Unit]
Description=mynginx
Requires=docker.service
After=docker-infra.service

[Service]
Restart=always
ExecStart=/usr/bin/docker start -a docker-nginx
ExecStop=/usr/bin/docker stop -t 2 docker-nginx

[Install]
WantedBy=multi-user.target

</code></pre></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/69/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/69/>69</a></li><li class="page-item active"><a class=page-link href=/page/70/>70</a></li><li class=page-item><a class=page-link href=/page/71/>71</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/234/>234</a></li><li class=page-item><a href=/page/71/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/234/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>