<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/05/13/changingedidinqemu/>ChangingEDIDInQemu</a></h1><span class=post-date>May 13, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=edid-retrieve>edid retrieve</h3><p>Install edid related packages:</p><pre><code>$ sudo apt install -y edid-decode read-edid
</code></pre><p>Find the edid in /sys:</p><pre><code>$ sudo find /sys | grep edid
/sys/kernel/debug/dri/0/Virtual-1/edid_override
/sys/devices/pci0000:00/0000:00:01.0/drm/card0/card0-Virtual-1/edid
/sys/module/drm_kms_helper/parameters/edid_firmware
/sys/module/drm/parameters/edid_firmware
/sys/module/drm/parameters/edid_fixup

</code></pre><p>The <code>/sys/devices/pci0000:00/0000:00:01.0/drm/card0/card0-Virtual-1/edid</code> file is your edid file, transfer it to windows machine.</p><h3 id=edid-modification>edid modification</h3><p>Using AW EDID Editor for editing the edid file:</p><p><img src=/images/2024_05_13_10_26_13_772x524.jpg alt=/images/2024_05_13_10_26_13_772x524.jpg></p><p>Remove the items you won&rsquo;t preserve:</p><p><img src=/images/2024_05_13_10_26_41_834x651.jpg alt=/images/2024_05_13_10_26_41_834x651.jpg></p><p>Modified items:</p><p><img src=/images/2024_05_13_10_27_10_554x397.jpg alt=/images/2024_05_13_10_27_10_554x397.jpg></p><h3 id=using-the-new-edid-file>Using the new edid file</h3><p>Edit the grub options:</p><pre><code>$ sudo vim /etc/default/grub
GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet drm.edid_firmware=Virtual-1:edid/edidno1080.bin&quot;
</code></pre><p>Add initram-tools hooks(Added scripts in kmod - the hacking way):</p><pre><code>$ cat /usr/share/initramfs-tools/hooks/kmod 

......
......
......
# hacking for edid
mkdir -p ${DESTDIR}/lib/firmware/edid
mkdir -p ${DESTDIR}/usr/lib/firmware/edid

cp /lib/firmware/edid/edidno4k.bin ${DESTDIR}/lib/firmware/edid/
cp /lib/firmware/edid/edidno1080.bin ${DESTDIR}/lib/firmware/edid/
cp /usr/lib/firmware/edid/edidno4k.bin ${DESTDIR}/usr/lib/firmware/edid/
cp /usr/lib/firmware/edid/edidno1080.bin ${DESTDIR}/usr/lib/firmware/edid/

</code></pre><p>Update the kernel and initramfs:</p><pre><code>$ sudo update-grub2
$ sudo update-initramfs -u -k all
</code></pre><h3 id=effects>Effects</h3><p>edid-decode result:</p><pre><code>root@idvrescue:/home/hhh# edid-decode &lt; /sys/devices/pci0000:00/0000:00:01.0/drm/card0/card0-Virtual-1/edid
......
hecksum: 0x47

----------------

Block 1, CTA-861 Extension Block:
  Revision: 3
  Native detailed modes: 0
  Video Data Block:
    VIC  31:  1920x1080   50.000000 Hz  16:9     56.250 kHz    148.500000 MHz
Checksum: 0x95

</code></pre><p>Dmesg output:</p><pre><code>$ sudo dmesg | grep edid
[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-6.1.0-18-amd64 root=UUID=f1fa5be7-1a17-46e3-ac0d-ab936027037e ro quiet drm.edid_firmware=Virtual-1:edid/edidno1080.bin
[    0.014022] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-6.1.0-18-amd64 root=UUID=f1fa5be7-1a17-46e3-ac0d-ab936027037e ro quiet drm.edid_firmware=Virtual-1:edid/edidno1080.bin
[    0.635432] [drm] features: -virgl +edid -resource_blob -host_visible
[    0.635877] platform Virtual-1: firmware: direct-loading firmware edid/edidno1080.bin
[    0.635885] [drm] Got external EDID base block and 1 extension from &quot;edid/edidno1080.bin&quot; for connector &quot;Virtual-1&quot;

</code></pre><p><img src=/images/2024_05_13_10_31_17_647x580.jpg alt=/images/2024_05_13_10_31_17_647x580.jpg></p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/05/08/workingtipsonincusbasedfogserver/>WorkingTipsOnIncusBasedFogServer</a></h1><span class=post-date>May 8, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=1-dhcpd服务器考虑>1. dhcpd服务器考虑</h3><h4 id=11-dhcpd在容器内出现的问题>1.1 dhcpd在容器内出现的问题</h4><p>因为incus内部使用的是私有网络，因此一旦将<code>isc-dhcp-server</code>启动在容器内，则只能监听容器内部的地址，而一旦更改子网定义为主机网络侧，则会出现dhcpd.conf检查错误:</p><pre><code>5月 08 08:58:44 fogincuschinese dhcpd[2532]: No subnet declaration for eth0 (10.147.148.100).
5月 08 08:58:44 fogincuschinese dhcpd[2532]: ** Ignoring requests on eth0.  If this is not what
5月 08 08:58:44 fogincuschinese dhcpd[2532]:    you want, please write a subnet declaration
5月 08 08:58:44 fogincuschinese dhcpd[2532]:    in your dhcpd.conf file for the network segment
5月 08 08:58:44 fogincuschinese dhcpd[2532]:    to which interface eth0 is attached. **
5月 08 08:58:44 fogincuschinese dhcpd[2532]: 
5月 08 08:58:44 fogincuschinese dhcpd[2532]: 
5月 08 08:58:44 fogincuschinese dhcpd[2532]: Not configured to listen on any interfaces!
</code></pre><p>出现上述问题的原因在于：容器内eth0为<code>10.147.148.100</code>, 而主机侧为<code>192.168.1.0.24</code>, 无法写如下的配置文件(diff文件更改了默认dhcpd.conf中的监听网段) :</p><pre><code>root@fogincuschinese:~# diff /etc/dhcp/dhcpd.conf /etc/dhcp/dhcpd.conf.back 
24c24
&lt; subnet 192.168.1.0 netmask 255.255.255.0{
---
&gt; subnet 10.147.148.0 netmask 255.255.255.0{
26c26
&lt;     range dynamic-bootp 192.168.1.50 192.168.1.90;
---
&gt;     range dynamic-bootp 10.147.148.10 10.147.148.254;
29c29
&lt;     option routers 192.168.1.33;
---
&gt;     option routers 10.147.148.1;
31c31
&lt;     next-server 192.168.1.40;
---
&gt;     next-server 10.147.148.100;
</code></pre><h4 id=12-dhcpd在主机上的实现>1.2 dhcpd在主机上的实现</h4><p>安装:</p><pre><code># apt install -y isc-dhcp-server
</code></pre><p>配置，使能:</p><pre><code>$ sudo vim /etc/dhcp/dhcpd.conf 
subnet 192.168.1.0 netmask 255.255.255.0{
    option subnet-mask 255.255.255.0;
    range dynamic-bootp 192.168.1.50 192.168.1.90;
    default-lease-time 21600;
    max-lease-time 43200;
    option routers 192.168.1.33;
    option domain-name-servers 223.5.5.5;
    next-server 192.168.1.40;
}
$ sudo systemctl daemon-reload
$ sudo systemctl start isc-dhcp-server
$ sudo systemctl enable isc-dhcp-server
</code></pre><p>需要对齐fogserver中的配置.</p><h3 id=2-tftpd服务>2. tftpd服务</h3><p>如果直接使用inpus中的容器，则因为tftp的通信协商机制中，会因为使用1024~65535的随机端口和客户端通信，而容器本身比较难搞定proxy, 而导致通信失败。<br>因此我们需要将tftpd也从里面搞出来， 在主机上实现。</p><p>但，如果做了这么多以后，还是容器吗？</p><p>所以上面的方式，未必适合</p><h3 id=3-macvlan网>3. macvlan网</h3><p>直接用macvlan直接覆盖。</p><p>注意替换IP：</p><pre><code>Change FOG Server IP Address
Procedural Steps
Follow appropriate steps for your Linux distribution to change the OS’s IP address.

Update the ipaddress= field (and other fields if necessary) inside the /opt/fog/.fogsettings file. The .fogsettings file.

Rerun the installer, you’ll need to use –recreate-CA and –recreate-keys keys as the installer provides a certificate with a Common Name based on the ip which will be shipped in the iPxe kernel and failed to load any https resources as the certificate isn’t valid anymore.

Update the IP address inside /tftpboot/default.ipxe (look for the chain line i.e chain https://x.x.x.x/fog/service/ipxe/boot.php##params)

Update the IP address for the storage node on the FOG system where you changed the IP address Web Interface -&gt; Storage Management

Update the IP address on a any master storage node that may reference this FOG server Web Interface -&gt; Storage Management

(For master server) Update the FOG_WEB_HOST value Web Interface -&gt; FOG Configuration -&gt; FOG Settings -&gt; Web Server -&gt; FOG_WEB_HOST

(For master server) Update the FOG_TFTP_HOST value Web Interface -&gt; FOG Configuration -&gt; FOG Settings -&gt; TFTP Server -&gt; FOG_TFTP_HOST

Optionaly if you have configured a dhcpd:

Update IP addresses (fog and gateway) inside the /etc/dhcp/dhcpd.conf.

Don’t forgot to check your /etc/export for nfs server as well as your apache2 configuration as the installer override it.
</code></pre><h3 id=incus-快速启动流程>incus 快速启动流程</h3><ol><li>用户需要安装好incus.</li><li>导入镜像，配置网路。</li><li>快速开出实例，作为Pxe和部署服务器使用。</li></ol><p>Steps:</p><pre><code>dash@server:~$ tar xzvf incusdebs.tar.gz
$ sudo chmod 777 -R incuddebs
$ sudo apt install -y incus
sudo adduser dash incus-admin

</code></pre><p>init yaml:</p><pre><code>config:
  images.auto_update_interval: &quot;0&quot;
networks: []
storage_pools:
- config: {}
  description: &quot;&quot;
  name: default
  driver: dir
profiles:
- config: {}
  description: &quot;&quot;
  devices:
    root:
      path: /
      pool: default
      type: disk
  name: default
projects: []
cluster: null
</code></pre><p>quickly init:</p><pre><code># cat init.sh 
cat &lt;&lt;EOF | incus admin init --preseed
config:
  images.auto_update_interval: &quot;0&quot;
networks: []
storage_pools:
- config: {}
  description: &quot;&quot;
  name: default
  driver: dir
profiles:
- config: {}
  description: &quot;&quot;
  devices:
    root:
      path: /
      pool: default
      type: disk
  name: default
projects: []
cluster: null
EOF

</code></pre><p>Create incusbr0(macvlan):</p><pre><code> incus network create incusbr0 --type=macvlan parent=enp7s0
</code></pre><p>Edit profile default:</p><pre><code>cat default.yaml | incus profile edit default
</code></pre><p>Add new profile:</p><pre><code>incus profile create nfs-server
    cat nfs-server-profile.yaml | incus profile edit nfs-server
</code></pre><p>另外的机器上导出镜像:</p><pre><code># incus publish fogincuschinese --alias fogAuto
Instance published with fingerprint: 0a4a4299661f19d880a203031b4e7df88996a99be110979975633baf9504b1dc
# incus image export fogAuto .
Image exported successfully!           

</code></pre><p>开始导入镜像:</p><pre><code># ls -l -h 0a4a4299661f19d880a203031b4e7df88996a99be110979975633baf9504b1dc.tar.gz 
-rw-rw-r-- 1 dash dash 857M May  8 09:06 0a4a4299661f19d880a203031b4e7df88996a99be110979975633baf9504b1dc.tar.gz
root@server:/home/dash# incus image import 0a4a4299661f19d880a203031b4e7df88996a99be110979975633baf9504b1dc.tar.gz --alias fogAuto
Image imported with fingerprint: 0a4a4299661f19d880a203031b4e7df88996a99be110979975633baf9504b1dc
root@server:/home/dash# incus image list
+---------+--------------+--------+----------------------------------------+--------------+-----------+-----------+----------------------+
|  ALIAS  | FINGERPRINT  | PUBLIC |              DESCRIPTION               | ARCHITECTURE |   TYPE    |   SIZE    |     UPLOAD DATE      |
+---------+--------------+--------+----------------------------------------+--------------+-----------+-----------+----------------------+
| fogAuto | 0a4a4299661f | no     | Debian bookworm amd64 (20240506_05:24) | x86_64       | CONTAINER | 856.42MiB | 2024/05/08 09:08 UTC |
+---------+--------------+--------+----------------------------------------+--------------+-----------+-----------+----------------------+

</code></pre><p>开始开出第一个实例:</p><pre><code># LANG=zh_CN.UTF-8 incus launch fogAuto fogInstance  -p nfs-server -p default -c security.privileged=true -c raw.apparmor=&quot;mount fstype=rpc_pipefs, mount fstype=nfsd,&quot;
Launching fogInstance
root@server:/home/dash# incus  list        
+-------------+---------+---------------------+------+-----------+-----------+
|    NAME     |  STATE  |        IPV4         | IPV6 |   TYPE    | SNAPSHOTS |
+-------------+---------+---------------------+------+-----------+-----------+
| fogInstance | RUNNING | 192.168.1.44 (eth0) |      | CONTAINER | 0         |
+-------------+---------+---------------------+------+-----------+-----------+
root@server:/home/dash# incus exec fogInstance bash
root@fogInstance:~# 

</code></pre><p>进入到实例里开始重新部署为<code>192.168.1.46</code>:</p><pre><code>root@fogInstance:~# cd regen/
root@fogInstance:~/regen# ls
1_regen.sh  2_reinstall.sh  cn-fogproject-master  inventoy.ini	mysql.sh  regen.yml  templates
root@fogInstance:~/regen# vim inventoy.ini 
root@fogInstance:~/regen# ./1_regen.sh 

PLAY [Write fogsettings] *********************************************************************************************************************************************************************

...
这里需要重启一次容器实例，非常快:   

root@server:/home/dash# incus exec fogInstance bash
root@fogInstance:~# cd regen/
root@fogInstance:~/regen# ./2_reinstall.sh 

</code></pre><p>push 镜像到相应位置:</p><pre><code>incus file push -pr idvnext/ fogInstance/images/idvnext/
</code></pre><p>接下来就可以愉快的玩耍了。</p><h3 id=综合>综合</h3><p>传递文件:</p><pre><code>$ scp -r hostincus/ dash@192.168.1.38:~
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/05/08/incusadjustnetworking/>incusAdjustNetworking</a></h1><span class=post-date>May 8, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>The default networking bridge <code>incusbr0</code> enabled the dhcp by default, that&rsquo;s not good for using dhcpd service in containers, so I have to remove the default behavior of the <code>incusbr0</code>, and add a new behavior for it.</p><p>Directly delete the bridge will get an error:</p><pre><code>$ incus network delete incusbr0
Error: The network is currently in use
</code></pre><p>Show this network&rsquo;s usage:</p><pre><code>$ incus network show incusbr0
config:
  ipv4.address: 10.147.148.1/24
  ipv4.nat: &quot;true&quot;
  ipv6.address: none
description: &quot;&quot;
name: incusbr0
type: bridge
used_by:
- /1.0/instances/fogincuschinese
- /1.0/instances/foginlxc
- /1.0/profiles/default
managed: true
status: Created
locations:
- none
</code></pre><p>Edit its profile:</p><pre><code>$ incus profile edit default
config: {}
description: Default Incus profile
devices:
-  eth0:
-    name: eth0
-    network: incusbr0
-    type: nic
  root:
    path: /
    pool: default
    type: disk
name: default
used_by:
- /1.0/instances/foginlxc
- /1.0/instances/fogincuschinese
</code></pre><p>Now you could delete this networking via:</p><pre><code>$ incus network delete incusbr0
Network incusbr0 deleted
</code></pre><p>RE-create the networking via following command(dhcpv4/v6 disabled):</p><pre><code>$ incus network create incusbr0 ipv4.dhcp=false ipv6.dhcp=false ipv4.address=10.147.148.1/24
Network incusbr0 created
</code></pre><p>Check this networking:</p><pre><code>$ ip a show incusbr0
10: incusbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 00:16:3e:c9:c4:e6 brd ff:ff:ff:ff:ff:ff
    inet 10.147.148.1/24 scope global incusbr0
       valid_lft forever preferred_lft forever
    inet6 fd42:1515:fb8e:9dab::1/64 scope global 
       valid_lft forever preferred_lft forever
</code></pre><p>RE-Add the networking profile into default:</p><pre><code>$ incus profile edit default
...
description: Default Incus profile
devices:
+  eth0:
+    name: eth0
+    network: incusbr0
+    type: nic
  root:
...

</code></pre><p>Re-lauch the previously stopped container instance:</p><pre><code>$ incus start fogincuschinese
$ incus list
+-----------------+---------+-----------------------+-----------------------------------------------+-----------+-----------+
|      NAME       |  STATE  |         IPV4          |                     IPV6                      |   TYPE    | SNAPSHOTS |
+-----------------+---------+-----------------------+-----------------------------------------------+-----------+-----------+
| fogincuschinese | RUNNING | 10.147.148.100 (eth0) | fd42:1515:fb8e:9dab:216:3eff:fef3:8307 (eth0) | CONTAINER | 0         |
+-----------------+---------+-----------------------+-----------------------------------------------+-----------+-----------+
</code></pre><p>Until now you could enable the dhcpd in container and then use forwarding rules for redirect to host.</p><p>Final command:</p><pre><code>incus network create incusbr0 ipv4.dhcp=false ipv4.address=10.147.148.1/24 ipv4.nat=true ipv6.address=none
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/04/28/installfogserverinincus/>InstallFogServerInIncus</a></h1><span class=post-date>Apr 28, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=bridge-ways>Bridge ways:</h3><p>Create incus instance:</p><pre><code>$ incus launch images:debian/12 fogserver
$ incus list                   
+-----------+---------+----------------------+-----------------------------------------------+-----------+-----------+
|   NAME    |  STATE  |         IPV4         |                     IPV6                      |   TYPE    | SNAPSHOTS |
+-----------+---------+----------------------+-----------------------------------------------+-----------+-----------+
| fogserver | RUNNING | 10.238.20.219 (eth0) | fd42:9396:9aca:8842:216:3eff:fe04:5da6 (eth0) | CONTAINER | 0         |
+-----------+---------+----------------------+-----------------------------------------------+-----------+-----------+
</code></pre><p>Configure the incus instance:</p><pre><code>dash@hope:~$ incus exec fogserver bash
root@fogserver:~# vi /etc/apt/sources.list
root@fogserver:~# cat /etc/apt/sources.list
# Generated by distrobuilder
deb http://mirrors.ustc.edu.cn/debian bookworm main
deb http://mirrors.ustc.edu.cn/debian bookworm-updates main
deb http://mirrors.ustc.edu.cn/debian-security/ bookworm-security main
root@fogserver:~# apt update -y &amp;&amp; apt install -y git
</code></pre><p>Fetch the source code:</p><pre><code>root@fogserver:~# git clone https://github.com/fogproject/fogproject.git fogproject-master

Cloning into 'fogproject-master'...
remote: Enumerating objects: 158214, done.
remote: Counting objects: 100% (4216/4216), done.
remote: Compressing objects: 100% (1073/1073), done.
remote: Total 158214 (delta 3135), reused 4011 (delta 3023), pack-reused 153998
Receiving objects: 100% (158214/158214), 848.89 MiB | 14.41 MiB/s, done.
Resolving deltas: 100% (112946/112946), done.
root@fogserver:~# du -hs fogproject-master/
890M	fogproject-master/
</code></pre><p>Using fogserver in container is not a good idea.</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2024/04/28/installinpusonubuntu2004/>InstallInpusOnUbuntu2004</a></h1><span class=post-date>Apr 28, 2024<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=1-installconfiguration>1. Install/Configuration</h3><p>Import keyring:</p><pre><code>mkdir -p /etc/apt/keyrings/
curl -fsSL https://pkgs.zabbly.com/key.asc -o /etc/apt/keyrings/zabbly.asc
</code></pre><p>update repository and install inpus:</p><pre><code>apt update -y
apt install -y incus
 apt install -y incus-ui-canonical
incus config set core.https_address :8443
</code></pre><p>Generate cert file in browser:</p><p><img src=/images/2024_04_28_09_32_56_1083x755.jpg alt=/images/2024_04_28_09_32_56_1083x755.jpg></p><p>In incus server:</p><pre><code>root@hope:~# cp /home/dash/Downloads/incus-ui.crt ./Downloads/
root@hope:~# incus config trust add-certificate Downloads/incus-ui.crt
</code></pre><p>In browser:</p><p><img src=/images/2024_04_28_09_34_37_1035x384.jpg alt=/images/2024_04_28_09_34_37_1035x384.jpg></p><p>The import file should be:</p><p><img src=/images/2024_04_28_09_34_57_414x98.jpg alt=/images/2024_04_28_09_34_57_414x98.jpg></p><p>Then back to browser windows, confirm the imported cert:</p><p><img src=/images/2024_04_28_09_35_08_630x331.jpg alt=/images/2024_04_28_09_35_08_630x331.jpg></p><p>Your UI would be looks like:</p><p><img src=/images/2024_04_28_09_35_46_945x645.jpg alt=/images/2024_04_28_09_35_46_945x645.jpg></p><p>Add your user into incus group:</p><pre><code>sudo adduser dash incus-admin
</code></pre><p>Init the incus:</p><pre><code>$ incus admin init
Would you like to use clustering? (yes/no) [default=no]: 
Do you want to configure a new storage pool? (yes/no) [default=yes]: 
Name of the new storage pool [default=default]: 
Name of the storage backend to use (dir, lvm, lvmcluster, btrfs) [default=btrfs]: dir
Would you like to create a new local network bridge? (yes/no) [default=yes]: 
What should the new bridge be called? [default=incusbr0]: 
What IPv4 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: 
What IPv6 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: 
Would you like the server to be available over the network? (yes/no) [default=no]: 
Would you like stale cached images to be updated automatically? (yes/no) [default=yes]: no
Would you like a YAML &quot;init&quot; preseed to be printed? (yes/no) [default=no]: 
</code></pre><p>Create the first instance:</p><pre><code>incus launch images:ubuntu/22.04 first
</code></pre><p>Finally we could remove lxd:</p><pre><code>$ sudo snap remove lxd
</code></pre><h3 id=2-images>2. images</h3><p>list image:</p><pre><code>$ incus image list
+-------+--------------+--------+----------------------------------------+--------------+-----------+-----------+----------------------+
| ALIAS | FINGERPRINT  | PUBLIC |              DESCRIPTION               | ARCHITECTURE |   TYPE    |   SIZE    |     UPLOAD DATE      |
+-------+--------------+--------+----------------------------------------+--------------+-----------+-----------+----------------------+
|       | 8b2691953577 | no     | Debian bookworm amd64 (20240424_05:24) | x86_64       | CONTAINER | 94.50MiB  | 2024/04/28 02:09 UTC |
+-------+--------------+--------+----------------------------------------+--------------+-----------+-----------+----------------------+
|       | 479d8812eada | no     | Ubuntu jammy amd64 (20240427_07:42)    | x86_64       | CONTAINER | 120.93MiB | 2024/04/28 01:55 UTC |
+-------+--------------+--------+----------------------------------------+--------------+-----------+-----------+----------------------+

</code></pre><p>incus remote show images repositories:</p><pre><code>$ incus remote list
+-----------------+------------------------------------+---------------+-------------+--------+--------+--------+
|      NAME       |                URL                 |   PROTOCOL    |  AUTH TYPE  | PUBLIC | STATIC | GLOBAL |
+-----------------+------------------------------------+---------------+-------------+--------+--------+--------+
| images          | https://images.linuxcontainers.org | simplestreams | none        | YES    | NO     | NO     |
+-----------------+------------------------------------+---------------+-------------+--------+--------+--------+
| local (current) | unix://                            | incus         | file access | NO     | YES    | NO     |
+-----------------+------------------------------------+---------------+-------------+--------+--------+--------+

</code></pre><p>search images:</p><pre><code>$ incus image list images: bookworm
+--------------------------------+--------------+--------+----------------------------------------+--------------+-----------------+-----------+----------------------+
|             ALIAS              | FINGERPRINT  | PUBLIC |              DESCRIPTION               | ARCHITECTURE |      TYPE       |   SIZE    |     UPLOAD DATE      |
+--------------------------------+--------------+--------+----------------------------------------+--------------+-----------------+-----------+----------------------+
| debian/12 (7 more)             | 2b5e45154f58 | yes    | Debian bookworm amd64 (20240424_05:24) | x86_64       | VIRTUAL-MACHINE | 349.13MiB | 2024/04/24 00:00 UTC |
+--------------------------------+--------------+--------+----------------------------------------+--------------+-----------------+-----------+----------------------+
| debian/12 (7 more)             | 8b2691953577 | yes    | Debian bookworm amd64 (20240424_05:24) | x86_64       | CONTAINER       | 94.50MiB  | 2024/04/24 00:00 UTC |
+--------------------------------+--------------+--------+----------------------------------------+--------------+-----------------+-----------+----------------------+
| debian/12/arm64 (3 more)       | dbba0a514259 | yes    | Debian bookworm arm64 (20240424_05:24) | aarch64      | CONTAINER       | 91.50MiB  | 2024/04/24 00:00 UTC |
+--------------------------------+--------------+--------+----------------------------------------+--------------+-----------------+-----------+----------------------+
| debian/12/arm64 (3 more)       | e2fc3247a569 | yes    | Debian bookworm arm64 (20240424_05:24) | aarch64      | VIRTUAL-MACHINE | 338.21MiB | 2024/04/24 00:00 UTC |
+--------------------------------+--------------+--------+----------------------------------------+--------------+-----------------+-----------+----------------------+
....
</code></pre><p>launch:</p><pre><code>incus launch -p default -p bridgeprofile images:debian/12 kissdebian
</code></pre></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/3/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item active"><a class=page-link href=/page/4/>4</a></li><li class=page-item><a class=page-link href=/page/5/>5</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/242/>242</a></li><li class=page-item><a href=/page/5/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/242/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>