<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta name=generator content="Hugo 0.64.0"><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Dash &#183; Dash</title><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/poole-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-overrides.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/hyde-a.css?ref=abc124"><link rel=stylesheet href="https://purplepalmdash.github.io/css/custom-additions.css?ref=abc124"><link rel=stylesheet href=https://purplepalmdash.github.io/css/highlight/googlecode.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/docco.min.css><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js></script><script type=text/javascript src=/js/html2canvas.js></script><script type=text/javascript>function genPostShot(){var rightNow=new Date();var imageName=rightNow.toISOString().slice(0,16).replace(/(-)|(:)|(T)/g,"");imageName+='.jpg'
html2canvas(document.getElementsByClassName('post'),{background:'#FFFFFF',onrendered:function(canvas){$('#test').attr('href',canvas.toDataURL("image/jpeg"));$('#test').attr('download',imageName);$('#test')[0].click();}});};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link rel=apple-touch-icon-precomposed sizes=144x144 href="http://purplepalmdash.github.io/touch-icon-144-precomposed.png?ref=abc124"><link href="http://purplepalmdash.github.io/favicon.png?ref=abc124" rel=icon><link href=%7balternate%20%7bRSS%20application/rss+xml%20%20index%20alternate%20%20false%20false%20true%20false%20false%200%7d%20/index.xml%20http://purplepalmdash.github.io/index.xml%7d rel=alternate type=application/rss+xml title="Dash &#183; Dash"><meta name=description content><meta name=keywords content="unix,virtualization,embedded,linux"></head><body class=theme-base-0c><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src=http://purplepalmdash.github.io/images/mylogo.jpeg alt=gravatar><h1><a href=http://purplepalmdash.github.io/>很惭愧，就做了一点微小的工作</a></h1><a href=http://purplepalmdash.github.io/><p>Dash</p></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/post/>All Posts</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/technology/>Technology</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/life/>Life</a></li><li class=sidebar-nav-item><a href=http://purplepalmdash.github.io/categories/linuxtips/>LinuxTips</a></li></ul><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/purplepalmdash><i class="fa fa-github-square fa-3x"></i></a><a href=https://cn.linkedin.com/in/yang-feipeng-1b909319><i class="fa fa-linkedin-square fa-3x"></i></a><a href=https://plus.google.com/u/0/106572959364703833986><i class="fa fa-google-plus-square fa-3x"></i></a><a href=https://www.facebook.com/yang.feipeng><i class="fa fa-facebook-square fa-3x"></i></a><a href=https://twitter.com/dashwillfly><i class="fa fa-twitter-square fa-3x"></i></a></li></ul></div></div><div class="content container"><div class=posts><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/07/27/pwdonubuntuiso/>PWDOnUbuntuISO</a></h1><span class=post-date>Jul 27, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=cubic>Cubic</h3><p>Using cubic, working window:</p><p><img src=/images/2018_07_27_22_07_25_615x581.jpg alt=/images/2018_07_27_22_07_25_615x581.jpg></p><p>Edit its <code>/etc/apt/sources.list</code>, changes to 163 mirror.</p><pre><code># apt-get update 
# apt-get install -y python-pip 
# pip install docker-compose
</code></pre></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/07/25/nodeexporteroncentos6/>NodeExporterOnCentOS6</a></h1><span class=post-date>Jul 25, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>从
<a href=https://github.com/prometheus/node_exporter/releases>https://github.com/prometheus/node_exporter/releases</a>,
下载适合机器架构的<code>node_exporter</code>版本，服务器上，通常下载为<code>amd64</code>的tar.gz包，而后解压。</p><p>下载daemonize的rpm包安装，我们需要这个包来保证<code>node_exporter</code>的daemon运行.</p><pre><code># wget https://forensics.cert.org/centos/cert/6/x86_64//daemonize-1.7.3-7.el6.x86_64.rpm
# rpm -ivh daemonize-1.7.3-7.el6.x86_64.rpm
</code></pre><p>解压<code>node_exporter</code>至<code>/usr/bin</code>目录下，现在开始撰写初始化脚本。</p><pre><code># vim /etc/init.d/node_exporter

    #!/bin/bash
    #
    #	/etc/rc.d/init.d/node_exporter
    #
    # chkconfig: 2345 80 80
    #
    # config: /etc/prometheus/node_exporter.conf
    # pidfile: /var/run/prometheus/node_exporter.pid
    
    # Source function library.
    . /etc/init.d/functions
    
    
    RETVAL=0
    PROG=&quot;node_exporter&quot;
    DAEMON_SYSCONFIG=/etc/sysconfig/${PROG}
    DAEMON=/usr/bin/${PROG}
    PID_FILE=/var/run/prometheus/${PROG}.pid
    LOCK_FILE=/var/lock/subsys/${PROG}
    LOG_FILE=/var/log/prometheus/node_exporter.log
    DAEMON_USER=&quot;prometheus&quot;
    FQDN=$(hostname --long)
    GOMAXPROCS=$(grep -c ^processor /proc/cpuinfo)
    
    . ${DAEMON_SYSCONFIG}
    
    start() {
      if check_status &gt; /dev/null; then
        echo &quot;node_exporter is already running&quot;
        exit 0
      fi
    
      echo -n $&quot;Starting node_exporter: &quot;
      daemonize -u ${DAEMON_USER} -p ${PID_FILE} -l ${LOCK_FILE} -a -e ${LOG_FILE} -o ${LOG_FILE} ${DAEMON} ${ARGS}
      RETVAL=$?
      echo &quot;&quot;
      return $RETVAL
    }
    
    stop() {
        echo -n $&quot;Stopping node_exporter: &quot;
        killproc -p ${PID_FILE} -d 10 ${DAEMON}
        RETVAL=$?
        echo
        [ $RETVAL = 0 ] &amp;&amp; rm -f ${LOCK_FILE} ${PID_FILE}
        return $RETVAL
    }  
    
    check_status() {
        status -p ${PID_FILE} ${DAEMON}
        RETVAL=$?
        return $RETVAL
    }
    
    case &quot;$1&quot; in
        start)
            start
            ;;
        stop)
            stop
            ;;
        status)
    	check_status
            ;;
        reload|force-reload)
            reload
            ;;
        restart)
            stop
            start
            ;;
        *)
            N=/etc/init.d/${NAME}
            echo &quot;Usage: $N {start|stop|status|restart|force-reload}&quot; &gt;&amp;2
            RETVAL=2
            ;;
    esac
    
    exit ${RETVAL}
</code></pre><p>同时在<code>/etc/sysconfig</code>目录下创建<code>node_exporter</code>文件，默认的我们不添加任何初始化参数（后面你可以添加自定义的启动参数用于控制node_exporter的启动）:</p><pre><code># vim /etc/sysconfig/node_exporter
ARGS=&quot;&quot;
</code></pre><p>我们的初始化脚本默认使用了<code>prometheus</code>用户，因而我们需要在系统中手动创建该用户，并创建对应的目录，以承载pid文件及存放log等:</p><pre><code># groupadd -r prometheus
# mkdir -p /usr/hostonnet/prometheus/
# useradd -r -g prometheus -s /sbin/nologin -d /usr/hostonnet/prometheus/ -c &quot;prometheus Daemons&quot; prometheus
# chown -R prometheus:prometheus /usr/hostonnet/prometheus/
# chown prometheus:prometheus /var/log/prometheus.log
# mkdir -p /var/run/prometheus/
# mkdir -p /var/log/prometheus/
# touch /var/log/prometheus/node_exporter.log
# chmod 777 /var/log/prometheus/node_exporter.log 
# chown prometheus:prometheus /var/log/prometheus/node_exporter.log
# /etc/init.d/node_exporter start
# chkconfig node_exporter on
</code></pre><p>检查，打开浏览器，查看<code>http://ipaddress:9100/metrics</code>是否可以看到对应导出的metrics即可。<br>prometheus的配置文件中，添加上该节点的metrics导出信息即可。</p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/07/25/monocularchinese/>MonocularChinese</a></h1><span class=post-date>Jul 25, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>Moncular汉化过程，记录如下:</p><pre><code># git clone https://github.com/kubernetes-helm/monocular.git
# cd monocular
# vim dev_env/ui/Dockerfile
    FROM bitnami/node:8
    
    # Install yarn
    RUN install_packages gnupg2
    RUN install_packages apt-transport-https &amp;&amp; \
      curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - &amp;&amp; \
      #echo &quot;deb https://dl.yarnpkg.com/debian/ stable main&quot; | tee /etc/apt/sources.list.d/yarn.list &amp;&amp; \
      echo &quot;deb https://dl.yarnpkg.com/debian/ stable main&quot; | tee /etc/apt/sources.list.d/yarn.list 
    RUN install_packages yarn
</code></pre><p>全程需要翻墙。<br>其中需要下载一大堆镜像，运行成功后用浏览器访问<code>http://localhost:4200</code>即可。在目录下编辑对应的文件，更改中文即可看到效果:</p><p><img src=/images/2018_07_25_09_10_33_735x531.jpg alt=/images/2018_07_25_09_10_33_735x531.jpg></p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/07/24/grafanachinese/>GrafanaChinese</a></h1><span class=post-date>Jul 24, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><p>公司内部要用到Grafana肯定会有各种阻力，最大阻力恐怕来自于很多同事英文不好。因而参考了网上的一个教程做grafana的汉化。实际的汉化我也没有做完，无非是做一个框架在这里，以后如果研发压力大，就直接铺人在上头做做翻译。</p><p>环境部署:</p><pre><code>$ git clone git://github.com/grafana/grafana
$ git checkout tags/v5.2.1 -b grafana_local
</code></pre><p>安装cnpm开发环境:</p><pre><code>$ sudo npm cache clean --force
$ sudo npm install -g cnpm --registry=https://registry.npm.taobao.org
$ which cnpm
/usr/bin/cnpm
</code></pre><p>开发环境初始化:</p><pre><code>$ cnpm install
$ npm start
</code></pre><p>此时，生成的代码将运行于
<code>localhost:3333</code>端口，我们需要一个本地运行的3000端口的grafana服务器来查看更改。</p><p>需要拷贝出已经运行容器里的<code>/usr/share/grafana</code>下的内容:</p><pre><code>$ sudo docker cp 66daaf6770b9:/usr/share/grafana .
</code></pre><p>而后更改<code>conf/defaults.ini</code>下的条目:</p><pre><code>app_mode = development
static_root_path = /public
</code></pre><p>现在重新启动该容器，注意需要挂载新的盘符至其中:</p><pre><code>sudo docker run -d -p 3000:3000 -e &quot;GF_SECURITY_ADMIN_PASSWORD=admin_password&quot; -v /media/sda5/grafana_db:/var/lib/grafana -v /home/xxxx/grafana/grafana:/usr/share/grafana -v /home/xxxx/Code/grafana/grafana/public:/public grafana/grafana
</code></pre><p>此时对代码的任一修改都可以很快体现在最终的<code>http://localhost:3000</code>网站中。</p><p>修改的一个截图如下:</p><p><img src=/images/2018_07_24_14_32_30_586x522.jpg alt=/images/2018_07_24_14_32_30_586x522.jpg></p></div><div class=post><h1 class=post-title><a href=http://purplepalmdash.github.io/blog/2018/07/23/prometheustips/>PrometheusTips</a></h1><span class=post-date>Jul 23, 2018<br><a class=a_cat href=http://purplepalmdash.github.io/categories/technology>Technology</a></span><h3 id=aim>AIM</h3><p>Setup prometheus monitoring system in inner intranet.<br>OS: CentOS/Ubuntu/RHEL, etc.</p><h3 id=prometheus-server>Prometheus Server</h3><p>Run server in following commands:</p><pre><code># vim /xxxxxx/prometheus/prometheus.yml
    global:
      scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
      evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
      # scrape_timeout is set to the global default (10s).
    
      # Attach these labels to any time series or alerts when communicating with
      # external systems (federation, remote storage, Alertmanager).
      external_labels:
        monitor: 'kkkkk-monitor'
    
    # Alertmanager configuration
    alerting:
      alertmanagers:
      - static_configs:
        - targets:
          # - alertmanager:9093
    
    # Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
    rule_files:
      # - &quot;first_rules.yml&quot;
      # - &quot;second_rules.yml&quot;
    
    # A scrape configuration containing exactly one endpoint to scrape:
    # Here it's Prometheus itself.
    scrape_configs:
      # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.
      - job_name: 'prometheus'
    
        # metrics_path defaults to '/metrics'
        # scheme defaults to 'http'.
    
        static_configs:
            - targets: ['localhost:9090', '192.192.189.1:9100']
    
# docker run -d -p 9090:9090 -v /xxxxxx/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml -v /media/sda5/prometheus:/prometheus prom/prometheus
</code></pre><h3 id=node-export>node-export</h3><p>In every node, run following:</p><pre><code># docker run -d  --net=&quot;host&quot;  --pid=&quot;host&quot;  quay.io/prometheus/node-exporter
</code></pre><h3 id=grafana>grafana</h3><p>Run grafana server via:</p><pre><code># docker run -d -p 3000:3000 -e &quot;GF_SECURITY_ADMIN_PASSWORD=admin_password&quot; -v /media/sda5/grafana_db:/var/lib/grafana grafana/grafana
</code></pre><p>Add grafana id of 1860(Node Exporter Full) or 159(Prometheus system), then you
could view the grafana displayed dashboard of node-exporter of the system.</p><h3 id=grafana-configuration>grafana configuration</h3><p>Initial picture:</p><p><img src=/images/2018_08_23_15_15_39_620x438.jpg alt=/images/2018_08_23_15_15_39_620x438.jpg></p><p>Add datasource:</p><p><img src=/images/2018_08_23_15_16_36_600x632.jpg alt=/images/2018_08_23_15_16_36_600x632.jpg></p><p>Add redis templates:</p><pre><code># wget https://raw.githubusercontent.com/oliver006/redis_exporter/master/contrib/grafana_prometheus_redis_dashboard_alias.json
</code></pre><p>Import:</p><p><img src=/images/2018_08_23_15_18_26_951x381.jpg alt=/images/2018_08_23_15_18_26_951x381.jpg></p><p>Detailed:</p><p><img src=/images/2018_08_23_15_18_58_584x566.jpg alt=/images/2018_08_23_15_18_58_584x566.jpg></p><p>Corresponding data source:</p><p><img src=/images/2018_08_23_15_19_39_358x467.jpg alt=/images/2018_08_23_15_19_39_358x467.jpg></p></div><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/73/ class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a class=page-link href=/page/3/>3</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/73/>73</a></li><li class="page-item active"><a class=page-link href=/page/74/>74</a></li><li class=page-item><a class=page-link href=/page/75/>75</a></li><li class="page-item disabled"><span aria-hidden=true>&nbsp;&mldr;&nbsp;</span></li><li class=page-item><a class=page-link href=/page/241/>241</a></li><li class=page-item><a href=/page/75/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/241/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div><script src=http://purplepalmdash.github.io/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>